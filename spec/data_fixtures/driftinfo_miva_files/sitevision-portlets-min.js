(function(){function b(r){return function(d,D,f,c){D=z(D,c,4);var b=!A(d)&&a.keys(d),e=(b||d).length,g=0<r?0:e-1;3>arguments.length&&(f=d[b?b[g]:g],g+=r);for(var h=D,k=f;0<=g&&g<e;g+=r)var n=b?b[g]:g,k=h(k,d[n],n,d);return k}}function l(a){return function(d,D,f){D=B(D,f);f=E(d);for(var c=0<a?0:f-1;0<=c&&c<f;c+=a)if(D(d[c],c,d))return c;return-1}}function m(r,d,f){return function(c,b,g){var e=0,k=E(c);if("number"==typeof g)0<r?e=0<=g?g:Math.max(g+k,e):k=0<=g?Math.min(g+1,k):g+k+1;else if(f&&g&&k)return g=
f(c,b),c[g]===b?g:-1;if(b!==b)return g=d(s.call(c,e,k),a.isNaN),0<=g?g+e:-1;for(g=0<r?e:k-1;0<=g&&g<k;g+=r)if(c[g]===b)return g;return-1}}function q(r,d){var f=K.length,g=r.constructor,g=a.isFunction(g)&&g.prototype||c,b="constructor";for(a.has(r,b)&&!a.contains(d,b)&&d.push(b);f--;)b=K[f],b in r&&r[b]!==g[b]&&!a.contains(d,b)&&d.push(b)}var e=this,p=e._,h=Array.prototype,c=Object.prototype,k=h.push,s=h.slice,n=c.toString,u=c.hasOwnProperty,v=Array.isArray,t=Object.keys,y=Function.prototype.bind,
C=Object.create,w=function(){},a=function(r){if(r instanceof a)return r;if(!(this instanceof a))return new a(r);this._wrapped=r};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=a),exports._=a):e._=a;a.VERSION="1.8.3";var z=function(a,d,f){if(void 0===d)return a;switch(null==f?3:f){case 1:return function(f){return a.call(d,f)};case 2:return function(f,D){return a.call(d,f,D)};case 3:return function(f,D,g){return a.call(d,f,D,g)};case 4:return function(f,
D,g,c){return a.call(d,f,D,g,c)}}return function(){return a.apply(d,arguments)}},B=function(r,d,f){return null==r?a.identity:a.isFunction(r)?z(r,d,f):a.isObject(r)?a.matcher(r):a.property(r)};a.iteratee=function(a,d){return B(a,d,Infinity)};var x=function(a,d){return function(f){var g=arguments.length;if(2>g||null==f)return f;for(var c=1;c<g;c++)for(var b=arguments[c],e=a(b),k=e.length,h=0;h<k;h++){var n=e[h];d&&void 0!==f[n]||(f[n]=b[n])}return f}},F=function(r){if(!a.isObject(r))return{};if(C)return C(r);
w.prototype=r;r=new w;w.prototype=null;return r},I=function(a){return function(d){return null==d?void 0:d[a]}},N=Math.pow(2,53)-1,E=I("length"),A=function(a){a=E(a);return"number"==typeof a&&0<=a&&a<=N};a.each=a.forEach=function(r,d,f){d=z(d,f);var g;if(A(r))for(f=0,g=r.length;f<g;f++)d(r[f],f,r);else{var c=a.keys(r);f=0;for(g=c.length;f<g;f++)d(r[c[f]],c[f],r)}return r};a.map=a.collect=function(r,d,f){d=B(d,f);f=!A(r)&&a.keys(r);for(var g=(f||r).length,c=Array(g),b=0;b<g;b++){var e=f?f[b]:b;c[b]=
d(r[e],e,r)}return c};a.reduce=a.foldl=a.inject=b(1);a.reduceRight=a.foldr=b(-1);a.find=a.detect=function(r,d,f){d=A(r)?a.findIndex(r,d,f):a.findKey(r,d,f);if(void 0!==d&&-1!==d)return r[d]};a.filter=a.select=function(r,d,f){var g=[];d=B(d,f);a.each(r,function(a,r,f){d(a,r,f)&&g.push(a)});return g};a.reject=function(r,d,f){return a.filter(r,a.negate(B(d)),f)};a.every=a.all=function(r,d,f){d=B(d,f);f=!A(r)&&a.keys(r);for(var g=(f||r).length,c=0;c<g;c++){var b=f?f[c]:c;if(!d(r[b],b,r))return!1}return!0};
a.some=a.any=function(r,d,f){d=B(d,f);f=!A(r)&&a.keys(r);for(var g=(f||r).length,c=0;c<g;c++){var b=f?f[c]:c;if(d(r[b],b,r))return!0}return!1};a.contains=a.includes=a.include=function(r,d,f,g){A(r)||(r=a.values(r));if("number"!=typeof f||g)f=0;return 0<=a.indexOf(r,d,f)};a.invoke=function(r,d){var f=s.call(arguments,2),g=a.isFunction(d);return a.map(r,function(a){var r=g?d:a[d];return null==r?r:r.apply(a,f)})};a.pluck=function(r,d){return a.map(r,a.property(d))};a.where=function(r,d){return a.filter(r,
a.matcher(d))};a.findWhere=function(r,d){return a.find(r,a.matcher(d))};a.max=function(r,d,f){var g=-Infinity,c=-Infinity,b;if(null==d&&null!=r){r=A(r)?r:a.values(r);for(var e=0,k=r.length;e<k;e++)f=r[e],f>g&&(g=f)}else d=B(d,f),a.each(r,function(a,r,f){b=d(a,r,f);if(b>c||-Infinity===b&&-Infinity===g)g=a,c=b});return g};a.min=function(r,d,f){var g=Infinity,c=Infinity,b;if(null==d&&null!=r){r=A(r)?r:a.values(r);for(var e=0,k=r.length;e<k;e++)f=r[e],f<g&&(g=f)}else d=B(d,f),a.each(r,function(a,r,f){b=
d(a,r,f);if(b<c||Infinity===b&&Infinity===g)g=a,c=b});return g};a.shuffle=function(r){r=A(r)?r:a.values(r);for(var d=r.length,f=Array(d),g=0,c;g<d;g++)c=a.random(0,g),c!==g&&(f[g]=f[c]),f[c]=r[g];return f};a.sample=function(d,f,g){return null==f||g?(A(d)||(d=a.values(d)),d[a.random(d.length-1)]):a.shuffle(d).slice(0,Math.max(0,f))};a.sortBy=function(d,f,g){f=B(f,g);return a.pluck(a.map(d,function(a,d,r){return{value:a,index:d,criteria:f(a,d,r)}}).sort(function(a,d){var r=a.criteria,f=d.criteria;if(r!==
f){if(r>f||void 0===r)return 1;if(r<f||void 0===f)return-1}return a.index-d.index}),"value")};var J=function(d){return function(f,g,c){var b={};g=B(g,c);a.each(f,function(a,c){var e=g(a,c,f);d(b,a,e)});return b}};a.groupBy=J(function(d,f,g){a.has(d,g)?d[g].push(f):d[g]=[f]});a.indexBy=J(function(a,d,f){a[f]=d});a.countBy=J(function(d,f,g){a.has(d,g)?d[g]++:d[g]=1});a.toArray=function(d){return d?a.isArray(d)?s.call(d):A(d)?a.map(d,a.identity):a.values(d):[]};a.size=function(d){return null==d?0:A(d)?
d.length:a.keys(d).length};a.partition=function(d,f,g){f=B(f,g);var c=[],b=[];a.each(d,function(a,d,r){(f(a,d,r)?c:b).push(a)});return[c,b]};a.first=a.head=a.take=function(d,f,g){return null==d?void 0:null==f||g?d[0]:a.initial(d,d.length-f)};a.initial=function(a,d,f){return s.call(a,0,Math.max(0,a.length-(null==d||f?1:d)))};a.last=function(d,f,g){return null==d?void 0:null==f||g?d[d.length-1]:a.rest(d,Math.max(0,d.length-f))};a.rest=a.tail=a.drop=function(a,d,f){return s.call(a,null==d||f?1:d)};a.compact=
function(d){return a.filter(d,a.identity)};var G=function(d,f,g,c){var b=[],e=0;c=c||0;for(var k=E(d);c<k;c++){var h=d[c];if(A(h)&&(a.isArray(h)||a.isArguments(h))){f||(h=G(h,f,g));var n=0,x=h.length;for(b.length+=x;n<x;)b[e++]=h[n++]}else g||(b[e++]=h)}return b};a.flatten=function(a,d){return G(a,d,!1)};a.without=function(d){return a.difference(d,s.call(arguments,1))};a.uniq=a.unique=function(d,f,g,c){a.isBoolean(f)||(c=g,g=f,f=!1);null!=g&&(g=B(g,c));c=[];for(var b=[],e=0,k=E(d);e<k;e++){var h=
d[e],n=g?g(h,e,d):h;f?(e&&b===n||c.push(h),b=n):g?a.contains(b,n)||(b.push(n),c.push(h)):a.contains(c,h)||c.push(h)}return c};a.union=function(){return a.uniq(G(arguments,!0,!0))};a.intersection=function(d){for(var f=[],g=arguments.length,c=0,b=E(d);c<b;c++){var e=d[c];if(!a.contains(f,e)){for(var h=1;h<g&&a.contains(arguments[h],e);h++);h===g&&f.push(e)}}return f};a.difference=function(d){var f=G(arguments,!0,!0,1);return a.filter(d,function(d){return!a.contains(f,d)})};a.zip=function(){return a.unzip(arguments)};
a.unzip=function(d){for(var f=d&&a.max(d,E).length||0,g=Array(f),c=0;c<f;c++)g[c]=a.pluck(d,c);return g};a.object=function(a,d){for(var f={},g=0,c=E(a);g<c;g++)d?f[a[g]]=d[g]:f[a[g][0]]=a[g][1];return f};a.findIndex=l(1);a.findLastIndex=l(-1);a.sortedIndex=function(a,d,f,g){f=B(f,g,1);d=f(d);g=0;for(var c=E(a);g<c;){var b=Math.floor((g+c)/2);f(a[b])<d?g=b+1:c=b}return g};a.indexOf=m(1,a.findIndex,a.sortedIndex);a.lastIndexOf=m(-1,a.findLastIndex);a.range=function(a,d,f){null==d&&(d=a||0,a=0);f=f||
1;d=Math.max(Math.ceil((d-a)/f),0);for(var g=Array(d),c=0;c<d;c++,a+=f)g[c]=a;return g};var L=function(d,f,g,c,b){if(!(c instanceof f))return d.apply(g,b);f=F(d.prototype);d=d.apply(f,b);return a.isObject(d)?d:f};a.bind=function(d,f){if(y&&d.bind===y)return y.apply(d,s.call(arguments,1));if(!a.isFunction(d))throw new TypeError("Bind must be called on a function");var g=s.call(arguments,2),c=function(){return L(d,c,f,this,g.concat(s.call(arguments)))};return c};a.partial=function(d){var f=s.call(arguments,
1),g=function(){for(var c=0,b=f.length,e=Array(b),h=0;h<b;h++)e[h]=f[h]===a?arguments[c++]:f[h];for(;c<arguments.length;)e.push(arguments[c++]);return L(d,g,this,this,e)};return g};a.bindAll=function(d){var f,g=arguments.length,c;if(1>=g)throw Error("bindAll must be passed function names");for(f=1;f<g;f++)c=arguments[f],d[c]=a.bind(d[c],d);return d};a.memoize=function(d,f){var g=function(c){var b=g.cache,e=""+(f?f.apply(this,arguments):c);a.has(b,e)||(b[e]=d.apply(this,arguments));return b[e]};g.cache=
{};return g};a.delay=function(a,d){var f=s.call(arguments,2);return setTimeout(function(){return a.apply(null,f)},d)};a.defer=a.partial(a.delay,a,1);a.throttle=function(d,f,g){var c,b,e,h=null,k=0;g||(g={});var n=function(){k=!1===g.leading?0:a.now();h=null;e=d.apply(c,b);h||(c=b=null)};return function(){var x=a.now();k||!1!==g.leading||(k=x);var u=f-(x-k);c=this;b=arguments;0>=u||u>f?(h&&(clearTimeout(h),h=null),k=x,e=d.apply(c,b),h||(c=b=null)):h||!1===g.trailing||(h=setTimeout(n,u));return e}};
a.debounce=function(d,f,g){var c,b,e,h,k,n=function(){var x=a.now()-h;x<f&&0<=x?c=setTimeout(n,f-x):(c=null,g||(k=d.apply(e,b),c||(e=b=null)))};return function(){e=this;b=arguments;h=a.now();var x=g&&!c;c||(c=setTimeout(n,f));x&&(k=d.apply(e,b),e=b=null);return k}};a.wrap=function(d,f){return a.partial(f,d)};a.negate=function(a){return function(){return!a.apply(this,arguments)}};a.compose=function(){var a=arguments,d=a.length-1;return function(){for(var f=d,g=a[d].apply(this,arguments);f--;)g=a[f].call(this,
g);return g}};a.after=function(a,d){return function(){if(1>--a)return d.apply(this,arguments)}};a.before=function(a,d){var f;return function(){0<--a&&(f=d.apply(this,arguments));1>=a&&(d=null);return f}};a.once=a.partial(a.before,2);var M=!{toString:null}.propertyIsEnumerable("toString"),K="valueOf isPrototypeOf toString propertyIsEnumerable hasOwnProperty toLocaleString".split(" ");a.keys=function(d){if(!a.isObject(d))return[];if(t)return t(d);var f=[],g;for(g in d)a.has(d,g)&&f.push(g);M&&q(d,f);
return f};a.allKeys=function(d){if(!a.isObject(d))return[];var f=[],g;for(g in d)f.push(g);M&&q(d,f);return f};a.values=function(d){for(var f=a.keys(d),g=f.length,c=Array(g),b=0;b<g;b++)c[b]=d[f[b]];return c};a.mapObject=function(d,f,g){f=B(f,g);g=a.keys(d);for(var c=g.length,b={},e,h=0;h<c;h++)e=g[h],b[e]=f(d[e],e,d);return b};a.pairs=function(d){for(var f=a.keys(d),g=f.length,c=Array(g),b=0;b<g;b++)c[b]=[f[b],d[f[b]]];return c};a.invert=function(d){for(var f={},g=a.keys(d),c=0,b=g.length;c<b;c++)f[d[g[c]]]=
g[c];return f};a.functions=a.methods=function(d){var f=[],g;for(g in d)a.isFunction(d[g])&&f.push(g);return f.sort()};a.extend=x(a.allKeys);a.extendOwn=a.assign=x(a.keys);a.findKey=function(d,f,g){f=B(f,g);g=a.keys(d);for(var c,b=0,e=g.length;b<e;b++)if(c=g[b],f(d[c],c,d))return c};a.pick=function(d,f,g){var c={},b=d,e,h;if(null==b)return c;a.isFunction(f)?(h=a.allKeys(b),e=z(f,g)):(h=G(arguments,!1,!1,1),e=function(d,a,f){return a in f},b=Object(b));for(var k=0,n=h.length;k<n;k++){var x=h[k],u=b[x];
e(u,x,b)&&(c[x]=u)}return c};a.omit=function(d,f,g){if(a.isFunction(f))f=a.negate(f);else{var c=a.map(G(arguments,!1,!1,1),String);f=function(d,f){return!a.contains(c,f)}}return a.pick(d,f,g)};a.defaults=x(a.allKeys,!0);a.create=function(d,f){var g=F(d);f&&a.extendOwn(g,f);return g};a.clone=function(d){return a.isObject(d)?a.isArray(d)?d.slice():a.extend({},d):d};a.tap=function(d,a){a(d);return d};a.isMatch=function(d,f){var g=a.keys(f),c=g.length;if(null==d)return!c;for(var b=Object(d),e=0;e<c;e++){var h=
g[e];if(f[h]!==b[h]||!(h in b))return!1}return!0};var H=function(d,f,g,c){if(d===f)return 0!==d||1/d===1/f;if(null==d||null==f)return d===f;d instanceof a&&(d=d._wrapped);f instanceof a&&(f=f._wrapped);var b=n.call(d);if(b!==n.call(f))return!1;switch(b){case "[object RegExp]":case "[object String]":return""+d===""+f;case "[object Number]":return+d!==+d?+f!==+f:0===+d?1/+d===1/f:+d===+f;case "[object Date]":case "[object Boolean]":return+d===+f}b="[object Array]"===b;if(!b){if("object"!=typeof d||
"object"!=typeof f)return!1;var e=d.constructor,h=f.constructor;if(e!==h&&!(a.isFunction(e)&&e instanceof e&&a.isFunction(h)&&h instanceof h)&&"constructor"in d&&"constructor"in f)return!1}g=g||[];c=c||[];for(e=g.length;e--;)if(g[e]===d)return c[e]===f;g.push(d);c.push(f);if(b){e=d.length;if(e!==f.length)return!1;for(;e--;)if(!H(d[e],f[e],g,c))return!1}else{b=a.keys(d);e=b.length;if(a.keys(f).length!==e)return!1;for(;e--;)if(h=b[e],!a.has(f,h)||!H(d[h],f[h],g,c))return!1}g.pop();c.pop();return!0};
a.isEqual=function(d,a){return H(d,a)};a.isEmpty=function(d){return null==d?!0:A(d)&&(a.isArray(d)||a.isString(d)||a.isArguments(d))?0===d.length:0===a.keys(d).length};a.isElement=function(d){return!(!d||1!==d.nodeType)};a.isArray=v||function(d){return"[object Array]"===n.call(d)};a.isObject=function(d){var a=typeof d;return"function"===a||"object"===a&&!!d};a.each("Arguments Function String Number Date RegExp Error".split(" "),function(d){a["is"+d]=function(a){return n.call(a)==="[object "+d+"]"}});
a.isArguments(arguments)||(a.isArguments=function(d){return a.has(d,"callee")});"function"!=typeof/./&&"object"!=typeof Int8Array&&(a.isFunction=function(d){return"function"==typeof d||!1});a.isFinite=function(d){return isFinite(d)&&!isNaN(parseFloat(d))};a.isNaN=function(d){return a.isNumber(d)&&d!==+d};a.isBoolean=function(d){return!0===d||!1===d||"[object Boolean]"===n.call(d)};a.isNull=function(d){return null===d};a.isUndefined=function(d){return void 0===d};a.has=function(d,a){return null!=d&&
u.call(d,a)};a.noConflict=function(){e._=p;return this};a.identity=function(d){return d};a.constant=function(d){return function(){return d}};a.noop=function(){};a.property=I;a.propertyOf=function(d){return null==d?function(){}:function(a){return d[a]}};a.matcher=a.matches=function(d){d=a.extendOwn({},d);return function(f){return a.isMatch(f,d)}};a.times=function(d,a,f){var g=Array(Math.max(0,d));a=z(a,f,1);for(f=0;f<d;f++)g[f]=a(f);return g};a.random=function(d,a){null==a&&(a=d,d=0);return d+Math.floor(Math.random()*
(a-d+1))};a.now=Date.now||function(){return(new Date).getTime()};v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};x=a.invert(v);I=function(d){var f=function(a){return d[a]},g="(?:"+a.keys(d).join("|")+")",c=RegExp(g),b=RegExp(g,"g");return function(d){d=null==d?"":""+d;return c.test(d)?d.replace(b,f):d}};a.escape=I(v);a.unescape=I(x);a.result=function(d,f,g){f=null==d?void 0:d[f];void 0===f&&(f=g);return a.isFunction(f)?f.call(d):f};var d=0;a.uniqueId=function(a){var f=
++d+"";return a?a+f:f};a.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var f=/(.)^/,g={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},P=/\\|'|\r|\n|\u2028|\u2029/g,Q=function(d){return"\\"+g[d]};a.template=function(d,g,c){!g&&c&&(g=c);g=a.defaults({},g,a.templateSettings);c=RegExp([(g.escape||f).source,(g.interpolate||f).source,(g.evaluate||f).source].join("|")+"|$","g");var b=0,e="__p+='";d.replace(c,function(a,f,g,
c,h){e+=d.slice(b,h).replace(P,Q);b=h+a.length;f?e+="'+\n((__t=("+f+"))==null?'':_.escape(__t))+\n'":g?e+="'+\n((__t=("+g+"))==null?'':__t)+\n'":c&&(e+="';\n"+c+"\n__p+='");return a});e+="';\n";g.variable||(e="with(obj||{}){\n"+e+"}\n");e="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+e+"return __p;\n";try{var h=new Function(g.variable||"obj","_",e)}catch(k){throw k.source=e,k;}c=function(d){return h.call(this,d,a)};c.source="function("+(g.variable||"obj")+
"){\n"+e+"}";return c};a.chain=function(d){d=a(d);d._chain=!0;return d};var O=function(d,f){return d._chain?a(f).chain():f};a.mixin=function(d){a.each(a.functions(d),function(f){var g=a[f]=d[f];a.prototype[f]=function(){var d=[this._wrapped];k.apply(d,arguments);return O(this,g.apply(a,d))}})};a.mixin(a);a.each("pop push reverse shift sort splice unshift".split(" "),function(d){var f=h[d];a.prototype[d]=function(){var a=this._wrapped;f.apply(a,arguments);"shift"!==d&&"splice"!==d||0!==a.length||delete a[0];
return O(this,a)}});a.each(["concat","join","slice"],function(d){var f=h[d];a.prototype[d]=function(){return O(this,f.apply(this._wrapped,arguments))}});a.prototype.value=function(){return this._wrapped};a.prototype.valueOf=a.prototype.toJSON=a.prototype.value;a.prototype.toString=function(){return""+this._wrapped};"function"===typeof define&&define.amd&&define("underscore",[],function(){return a})}).call(this);window._sv=_.noConflict();
(function(){var b=this,l=b.Backbone,m=[],q=m.push,e=m.slice,p=m.splice,h;h="undefined"!==typeof exports?exports:b.Backbone={};h.VERSION="1.0.0";var c=b._sv;c||"undefined"===typeof require||(c=require("underscore"));h.$=b.jQuery||b.Zepto||b.ender||b.$;h.noConflict=function(){b.Backbone=l;return this};h.emulateHTTP=!1;h.emulateJSON=!1;var k=h.Events={on:function(d,a,g){if(!n(this,"on",d,[a,g])||!a)return this;this._events||(this._events={});(this._events[d]||(this._events[d]=[])).push({callback:a,context:g,
ctx:g||this});return this},once:function(d,a,g){if(!n(this,"once",d,[a,g])||!a)return this;var b=this,e=c.once(function(){b.off(d,e);a.apply(this,arguments)});e._callback=a;return this.on(d,e,g)},off:function(d,a,g){var b,e,h,k,x,u,l,z;if(!this._events||!n(this,"off",d,[a,g]))return this;if(!d&&!a&&!g)return this._events={},this;k=d?[d]:c.keys(this._events);x=0;for(u=k.length;x<u;x++)if(d=k[x],h=this._events[d]){this._events[d]=b=[];if(a||g)for(l=0,z=h.length;l<z;l++)e=h[l],(a&&a!==e.callback&&a!==
e.callback._callback||g&&g!==e.context)&&b.push(e);b.length||delete this._events[d]}return this},trigger:function(d){if(!this._events)return this;var a=e.call(arguments,1);if(!n(this,"trigger",d,a))return this;var g=this._events[d],c=this._events.all;g&&u(g,a);c&&u(c,arguments);return this},stopListening:function(d,a,g){var c=this._listeners;if(!c)return this;var b=!a&&!g;"object"===typeof a&&(g=this);d&&((c={})[d._listenerId]=d);for(var e in c)c[e].off(a,g,this),b&&delete this._listeners[e];return this}},
s=/\s+/,n=function(d,a,g,c){if(!g)return!0;if("object"===typeof g){for(var b in g)d[a].apply(d,[b,g[b]].concat(c));return!1}if(s.test(g)){g=g.split(s);b=0;for(var e=g.length;b<e;b++)d[a].apply(d,[g[b]].concat(c));return!1}return!0},u=function(d,a){var g,c=-1,b=d.length,e=a[0],h=a[1],k=a[2];switch(a.length){case 0:for(;++c<b;)(g=d[c]).callback.call(g.ctx);break;case 1:for(;++c<b;)(g=d[c]).callback.call(g.ctx,e);break;case 2:for(;++c<b;)(g=d[c]).callback.call(g.ctx,e,h);break;case 3:for(;++c<b;)(g=
d[c]).callback.call(g.ctx,e,h,k);break;default:for(;++c<b;)(g=d[c]).callback.apply(g.ctx,a)}};c.each({listenTo:"on",listenToOnce:"once"},function(d,a){k[a]=function(a,f,b){var e=this._listeners||(this._listeners={}),h=a._listenerId||(a._listenerId=c.uniqueId("l"));e[h]=a;"object"===typeof f&&(b=this);a[d](f,b,this);return this}});k.bind=k.on;k.unbind=k.off;c.extend(h,k);var v=h.Model=function(d,a){var g,b=d||{};a||(a={});this.cid=c.uniqueId("c");this.attributes={};c.extend(this,c.pick(a,t));a.parse&&
(b=this.parse(b,a)||{});if(g=c.result(this,"defaults"))b=c.defaults({},b,g);this.set(b,a);this.changed={};this.initialize.apply(this,arguments)},t=["url","urlRoot","collection"];c.extend(v.prototype,k,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(d){return c.clone(this.attributes)},sync:function(){return h.sync.apply(this,arguments)},get:function(d){return this.attributes[d]},escape:function(d){return c.escape(this.get(d))},has:function(d){return null!=
this.get(d)},set:function(d,a,g){var b,e,h,k,n,x,u;if(null==d)return this;"object"===typeof d?(e=d,g=a):(e={})[d]=a;g||(g={});if(!this._validate(e,g))return!1;h=g.unset;k=g.silent;d=[];n=this._changing;this._changing=!0;n||(this._previousAttributes=c.clone(this.attributes),this.changed={});u=this.attributes;x=this._previousAttributes;this.idAttribute in e&&(this.id=e[this.idAttribute]);for(b in e)a=e[b],c.isEqual(u[b],a)||d.push(b),c.isEqual(x[b],a)?delete this.changed[b]:this.changed[b]=a,h?delete u[b]:
u[b]=a;if(!k)for(d.length&&(this._pending=!0),a=0,b=d.length;a<b;a++)this.trigger("change:"+d[a],this,u[d[a]],g);if(n)return this;if(!k)for(;this._pending;)this._pending=!1,this.trigger("change",this,g);this._changing=this._pending=!1;return this},unset:function(d,a){return this.set(d,void 0,c.extend({},a,{unset:!0}))},clear:function(d){var a={},g;for(g in this.attributes)a[g]=void 0;return this.set(a,c.extend({},d,{unset:!0}))},hasChanged:function(d){return null==d?!c.isEmpty(this.changed):c.has(this.changed,
d)},changedAttributes:function(d){if(!d)return this.hasChanged()?c.clone(this.changed):!1;var a,g=!1,b=this._changing?this._previousAttributes:this.attributes,e;for(e in d)c.isEqual(b[e],a=d[e])||((g||(g={}))[e]=a);return g},previous:function(d){return null!=d&&this._previousAttributes?this._previousAttributes[d]:null},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(d){d=d?c.clone(d):{};void 0===d.parse&&(d.parse=!0);var a=this,g=d.success;d.success=function(c){if(!a.set(a.parse(c,
d),d))return!1;g&&g(a,c,d);a.trigger("sync",a,c,d)};H(this,d);return this.sync("read",this,d)},save:function(d,a,g){var b,e=this.attributes;null==d||"object"===typeof d?(b=d,g=a):(b={})[d]=a;if(!(!b||g&&g.wait||this.set(b,g)))return!1;g=c.extend({validate:!0},g);if(!this._validate(b,g))return!1;b&&g.wait&&(this.attributes=c.extend({},e,b));void 0===g.parse&&(g.parse=!0);var h=this,k=g.success;g.success=function(d){h.attributes=e;var a=h.parse(d,g);g.wait&&(a=c.extend(b||{},a));if(c.isObject(a)&&!h.set(a,
g))return!1;k&&k(h,d,g);h.trigger("sync",h,d,g)};H(this,g);d=this.isNew()?"create":g.patch?"patch":"update";"patch"===d&&(g.attrs=b);d=this.sync(d,this,g);b&&g.wait&&(this.attributes=e);return d},destroy:function(d){d=d?c.clone(d):{};var a=this,g=d.success,b=function(){a.trigger("destroy",a,a.collection,d)};d.success=function(c){(d.wait||a.isNew())&&b();g&&g(a,c,d);a.isNew()||a.trigger("sync",a,c,d)};if(this.isNew())return d.success(),!1;H(this,d);var e=this.sync("delete",this,d);d.wait||b();return e},
url:function(){var d=c.result(this,"urlRoot")||c.result(this.collection,"url")||K();return this.isNew()?d:d+("/"===d.charAt(d.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(d,a){return d},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(d){return this._validate({},c.extend(d||{},{validate:!0}))},_validate:function(d,a){if(!a.validate||!this.validate)return!0;d=c.extend({},this.attributes,d);var g=this.validationError=
this.validate(d,a)||null;if(!g)return!0;this.trigger("invalid",this,g,c.extend(a||{},{validationError:g}));return!1}});c.each("keys values pairs invert pick omit".split(" "),function(d){v.prototype[d]=function(){var a=e.call(arguments);a.unshift(this.attributes);return c[d].apply(c,a)}});var y=h.Collection=function(d,a){a||(a={});a.url&&(this.url=a.url);a.model&&(this.model=a.model);void 0!==a.comparator&&(this.comparator=a.comparator);this._reset();this.initialize.apply(this,arguments);d&&this.reset(d,
c.extend({silent:!0},a))},C={add:!0,remove:!0,merge:!0},w={add:!0,merge:!1,remove:!1};c.extend(y.prototype,k,{model:v,initialize:function(){},toJSON:function(d){return this.map(function(a){return a.toJSON(d)})},sync:function(){return h.sync.apply(this,arguments)},add:function(d,a){return this.set(d,c.defaults(a||{},w))},remove:function(d,a){d=c.isArray(d)?d.slice():[d];a||(a={});var g,b,e,h;g=0;for(b=d.length;g<b;g++)if(h=this.get(d[g]))delete this._byId[h.id],delete this._byId[h.cid],e=this.indexOf(h),
this.models.splice(e,1),this.length--,a.silent||(a.index=e,h.trigger("remove",h,this,a)),this._removeReference(h);return this},set:function(d,a){a=c.defaults(a||{},C);a.parse&&(d=this.parse(d,a));c.isArray(d)||(d=d?[d]:[]);var g,b,e,h,k,n=a.at,x=this.comparator&&null==n&&!1!==a.sort,u=c.isString(this.comparator)?this.comparator:null,l=[],z=[],m={};g=0;for(b=d.length;g<b;g++)if(e=this._prepareModel(d[g],a))(h=this.get(e))?(a.remove&&(m[h.cid]=!0),a.merge&&(h.set(e.attributes,a),x&&!k&&h.hasChanged(u)&&
(k=!0))):a.add&&(l.push(e),e.on("all",this._onModelEvent,this),this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e));if(a.remove){g=0;for(b=this.length;g<b;++g)m[(e=this.models[g]).cid]||z.push(e);z.length&&this.remove(z,a)}l.length&&(x&&(k=!0),this.length+=l.length,null!=n?p.apply(this.models,[n,0].concat(l)):q.apply(this.models,l));k&&this.sort({silent:!0});if(a.silent)return this;g=0;for(b=l.length;g<b;g++)(e=l[g]).trigger("add",e,this,a);k&&this.trigger("sort",this,a);return this},reset:function(a,
f){f||(f={});for(var g=0,b=this.models.length;g<b;g++)this._removeReference(this.models[g]);f.previousModels=this.models;this._reset();this.add(a,c.extend({silent:!0},f));f.silent||this.trigger("reset",this,f);return this},push:function(a,f){a=this._prepareModel(a,f);this.add(a,c.extend({at:this.length},f));return a},pop:function(a){var f=this.at(this.length-1);this.remove(f,a);return f},unshift:function(a,f){a=this._prepareModel(a,f);this.add(a,c.extend({at:0},f));return a},shift:function(a){var f=
this.at(0);this.remove(f,a);return f},slice:function(a,f){return this.models.slice(a,f)},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,f){return c.isEmpty(a)?f?void 0:[]:this[f?"find":"filter"](function(f){for(var b in a)if(a[b]!==f.get(b))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw Error("Cannot sort a set without a comparator");a||(a={});c.isString(this.comparator)||
1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(c.bind(this.comparator,this));a.silent||this.trigger("sort",this,a);return this},sortedIndex:function(a,f,g){f||(f=this.comparator);var b=c.isFunction(f)?f:function(a){return a.get(f)};return c.sortedIndex(this.models,a,b,g)},pluck:function(a){return c.invoke(this.models,"get",a)},fetch:function(a){a=a?c.clone(a):{};void 0===a.parse&&(a.parse=!0);var f=a.success,g=this;a.success=function(b){g[a.reset?"reset":
"set"](b,a);f&&f(g,b,a);g.trigger("sync",g,b,a)};H(this,a);return this.sync("read",this,a)},create:function(a,f){f=f?c.clone(f):{};if(!(a=this._prepareModel(a,f)))return!1;f.wait||this.add(a,f);var g=this,b=f.success;f.success=function(c){f.wait&&g.add(a,f);b&&b(a,c,f)};a.save(null,f);return a},parse:function(a,f){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,f){if(a instanceof v)return a.collection||
(a.collection=this),a;f||(f={});f.collection=this;var g=new this.model(a,f);return g._validate(a,f)?g:(this.trigger("invalid",this,a,f),!1)},_removeReference:function(a){this===a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,f,g,b){if("add"!==a&&"remove"!==a||g===this)"destroy"===a&&this.remove(f,b),f&&a==="change:"+f.idAttribute&&(delete this._byId[f.previous(f.idAttribute)],null!=f.id&&(this._byId[f.id]=f)),this.trigger.apply(this,arguments)}});c.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min toArray size first head take initial rest tail drop last without indexOf shuffle lastIndexOf isEmpty chain".split(" "),
function(a){y.prototype[a]=function(){var f=e.call(arguments);f.unshift(this.models);return c[a].apply(c,f)}});c.each(["groupBy","countBy","sortBy"],function(a){y.prototype[a]=function(f,g){var b=c.isFunction(f)?f:function(a){return a.get(f)};return c[a](this.models,b,g)}});var m=h.View=function(a){this.cid=c.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},a=/^(\S+)\s*(.*)$/,z="model collection el id attributes className tagName events".split(" ");
c.extend(m.prototype,k,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(a,f){this.$el&&this.undelegateEvents();this.$el=a instanceof h.$?a:h.$(a);this.el=this.$el[0];!1!==f&&this.delegateEvents();return this},delegateEvents:function(d){if(!d&&!(d=c.result(this,"events")))return this;this.undelegateEvents();for(var f in d){var g=d[f];c.isFunction(g)||
(g=this[d[f]]);if(g){var b=f.match(a),e=b[1],b=b[2],g=c.bind(g,this),e=e+(".delegateEvents"+this.cid);if(""===b)this.$el.on(e,g);else this.$el.on(e,b,g)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(a){this.options&&(a=c.extend({},c.result(this,"options"),a));c.extend(this,c.pick(a,z));this.options=a},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"),!1);else{var a=c.extend({},c.result(this,"attributes"));
this.id&&(a.id=c.result(this,"id"));this.className&&(a["class"]=c.result(this,"className"));a=h.$("<"+c.result(this,"tagName")+">").attr(a);this.setElement(a,!1)}}});h.sync=function(a,f,b){var e=B[a];c.defaults(b||(b={}),{emulateHTTP:h.emulateHTTP,emulateJSON:h.emulateJSON});var k={type:e,dataType:"json"};b.url||(k.url=c.result(f,"url")||K());null!=b.data||!f||"create"!==a&&"update"!==a&&"patch"!==a||(k.contentType="application/json",k.data=JSON.stringify(b.attrs||f.toJSON(b)));b.emulateJSON&&(k.contentType=
"application/x-www-form-urlencoded",k.data=k.data?{model:k.data}:{});if(b.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){k.type="POST";b.emulateJSON&&(k.data._method=e);var n=b.beforeSend;b.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",e);if(n)return n.apply(this,arguments)}}"GET"===k.type||b.emulateJSON||(k.processData=!1);"PATCH"!==k.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(k.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});
a=b.xhr=h.ajax(c.extend(k,b));f.trigger("request",f,a,b);return a};var B={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};h.ajax=function(){return h.$.ajax.apply(h.$,arguments)};var x=h.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},F=/\((.*?)\)/g,I=/(\(\?)?:\w+/g,N=/\*\w+/g,E=/[\-{}\[\]+?.,\\\^$|#\s]/g;c.extend(x.prototype,k,{initialize:function(){},route:function(a,f,b){c.isRegExp(a)||(a=this._routeToRegExp(a));
c.isFunction(f)&&(b=f,f="");b||(b=this[f]);var e=this;h.history.route(a,function(c){c=e._extractParameters(a,c);b&&b.apply(e,c);e.trigger.apply(e,["route:"+f].concat(c));e.trigger("route",f,c);h.history.trigger("route",e,f,c)});return this},navigate:function(a,b){h.history.navigate(a,b);return this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var a,b=c.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(E,"\\$&").replace(F,
"(?:$1)?").replace(I,function(a,d){return d?a:"([^/]+)"}).replace(N,"(.*?)");return new RegExp("^"+a+"$")},_extractParameters:function(a,b){var g=a.exec(b).slice(1);return c.map(g,function(a){return a?decodeURIComponent(a):null})}});var A=h.History=function(){this.handlers=[];c.bindAll(this,"checkUrl");"undefined"!==typeof window&&(this.location=window.location,this.history=window.history)},J=/^[#\/]|\s+$/g,G=/^\/+|\/+$/g,L=/msie [\w.]+/,M=/\/$/;A.started=!1;c.extend(A.prototype,k,{interval:50,getHash:function(a){return(a=
(a||this).location.href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(M,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(J,"")},start:function(a){if(A.started)throw Error("Backbone.history has already been started");A.started=!0;this.options=c.extend({},{root:"/"},this.options,a);this.root=this.options.root;this._wantsHashChange=!1!==this.options.hashChange;
this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);a=this.getFragment();var b=document.documentMode,b=L.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b);this.root=("/"+this.root+"/").replace(G,"/");b&&this._wantsHashChange&&(this.iframe=h.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a));if(this._hasPushState)h.$(window).on("popstate",this.checkUrl);else if(this._wantsHashChange&&
"onhashchange"in window&&!b)h.$(window).on("hashchange",this.checkUrl);else this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=a;a=this.location;b=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&b&&a.hash&&(this.fragment=
this.getHash().replace(J,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search));if(!this.options.silent)return this.loadUrl()},stop:function(){h.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);A.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a===this.fragment)return!1;
this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return c.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,b){if(!A.started)return!1;b&&!0!==b||(b={trigger:b});a=this.getFragment(a||"");if(this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else if(this._wantsHashChange)this._updateHash(this.location,
a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace));else return this.location.assign(c);b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){c?(c=a.href.replace(/(javascript:|#).*$/,""),a.replace(c+"#"+b)):a.hash="#"+b}});h.history=new A;v.extend=y.extend=x.extend=m.extend=A.extend=function(a,b){var g=this,e;e=a&&c.has(a,"constructor")?a.constructor:function(){return g.apply(this,
arguments)};c.extend(e,g,b);var h=function(){this.constructor=e};h.prototype=g.prototype;e.prototype=new h;a&&c.extend(e.prototype,a);e.__super__=g.prototype;return e};var K=function(){throw Error('A "url" property or function must be specified');},H=function(a,b){var c=b.error;b.error=function(e){c&&c(a,e,b);a.trigger("error",a,e,b)}}}).call(this);window.SVBackbone=Backbone.noConflict();SVBackbone.$=$svjq;
(function(){function b(b,c,e){var l=window.sv.ErrorUtil;l&&l.handleBackboneError(b,c,e)}var l=window.SVBackbone,m=l.Model.prototype.fetch,q=l.Model.prototype.save,e=l.Model.prototype.destroy,p=l.Collection.prototype.fetch;l.Model.prototype.fetch=function(e){e=e||{};e.error=e.error||b;return m.apply(this,[e])};l.Model.prototype.save=function(e,c,k){null==e||"object"===typeof e?(c=c||{},c.error=c.error||b):(k=k||{},k.error=k.error||b);return q.apply(this,[e,c,k])};l.Model.prototype.destroy=function(h){h=
h||{};h.error=h.error||b;return e.apply(this,[h])};l.Collection.prototype.fetch=function(e){e=e||{};e.error=e.error||b;return p.apply(this,[e])}})();
(function(){var b=window.sv,l=b.ObjectUtil,m=b.Log,q=window.$svjq,e=window._sv,p=function(b){return(b=(new RegExp("[\\?&]"+b+"=([^&#]*)")).exec(window.location.href))?b[1]:null},h=function(b,c,e){var h;h="string"===q.type(b)?q(b):b;q.get(c,function(b){h.fadeOut("fast",function(){h.html(b);h.fadeIn();q.isFunction(e)&&e.call(this)})})},c={};b.PortletUtil={getModelObjectUri:function(c,e,h){c="/modelobjectapi/1/"+b.PageContext.pageId+"/"+c+"/"+e;h&&(c+="/"+h);return c},getEditApiUri:function(c){var e=
c.modelHandler,h=c.objectId,u=c.operationObjectId,l=c.contextNodeId||b.PageContext.pageId;"string"===typeof c&&(e=c);h||(h=b.PageContext.pageId);c="/edit-api/1/"+l+"/"+h+"/"+e;u&&(c+="/"+u);return c},getPortletUri:function(c,e){return"/"+b.PageContext.pageId+"/"+c+".xml?state="+e},getPortletResourceUri:function(c,e){var h=p("identity"),l=p("group"),m=p("tag");return"/portletresource/"+b.PageContext.pageId+"/"+c+"?state="+e+(h?"&identity="+h:"")+(l?"&group="+l:"")+(m?"&tag="+m:"")},reloadPortletsByType:function(c,
e){var n=q(c);q.each(n,function(){var c=q(this),k=c.attr("id"),k=l.getObjectId(k);h(c,"/"+b.PageContext.pageId+"/"+k+".xml"+(e||""))})},doGetWithFade:h,doGet:function(b,c){q.get(c,function(c){q(b).html(c)})},getTemplate:function(b,h){var n=b.attr("id"),l;if(n){n=n.replace(".","_");if(!c[n+h]){l=b.find("script.sv-tmpl-"+h);if(0===l.length){m.warn("portletUtil","Could not find template with name "+h+" for portlet "+n);return}c[n+h]=e.template(l.html())}return c[n+h]}m.warn("portletUtil","Tried to get template from invalid element")}}})();
(function(){var b=window.$svjq,l=window.sv,m=l.KeyUtil,q=l.DialogUtil,e=l.PortletUtil,p=l.DateUtil,h=l.Events,c=window.moment,k=window.SVBackbone,s=b("html").hasClass("sv-touch"),n=function(a,b){return l.i18n.getText("common",a,b)},u,v=k.View.extend({template:function(){return e.getTemplate(this.options.$portlet,this.templateName)},memberTemplate:function(){return e.getTemplate(this.options.$portlet,this.memberTemplateName)},participantTemplate:function(){return e.getTemplate(this.options.$portlet,
this.participantTemplateName)},events:{"click [data-fn-allday]":"toggleTimeVisibility",'keyup [name="where"]':"showMapLink"},initialize:function(a){this.options=a;this.originalValues={};a=this.template();var c=b.extend(this.model.toJSON(),this.templateHelpers);this.$el.append(a(c));this.listenTo(this.model,"invalid",this.handleErrors);this.ui={startDate:this.$el.find("[name=startDate]"),startTime:this.$el.find("[data-fn-time-value-start]"),endDate:this.$el.find("[name=endDate]"),endTime:this.$el.find("[data-fn-time-value-end]"),
allDay:this.$el.find("[name=allDay]"),isDone:this.$el.find("[name=isDone]"),owner:this.$el.find("#owner"),participants:this.$el.find("#participants")}},render:function(){var a=this,h=[{text:n("cancel"),callback:function(){b(".modal").modal("hide");a.restoreChanges()}}];this.model.isNew()?h.push({text:this.i18n("create"),skipDismiss:!0,primary:!0,callback:function(){a.saveChanges()}}):h.push({text:n("remove"),danger:!0,callback:b.proxy(this.removeActivity,this)},{text:n("ok"),skipDismiss:!0,primary:!0,
callback:function(){a.saveChanges()}});q.showDialog({title:this.model.attributes.isTask?this.i18n("task"):this.i18n("event"),body:this.$el,buttons:h,removeOnHide:!0,errorTitle:n("networkErrorTitle"),errorMsg:n("networkErrorText")});h={format:c.langData()._longDateFormat.L.toLowerCase(),autoclose:!0};this.ui.startDate.bootstrapDatepicker(h).on("change",b.proxy(function(){var a=this.ui.endDate.val(),b=this.ui.startDate.bootstrapDatepicker("getDate");!a&&b&&this.ui.endDate.bootstrapDatepicker("setDate",
b)},this));this.ui.endDate.bootstrapDatepicker(h);var h=this.$el.parent().parent(),k={decimal:n("decimal"),mins:n("mins"),hr:n("hr"),hrs:n("hrs")},x=p.moment2PhpFormat(c.langData()._longDateFormat.LT);this.ui.startTime.timepicker({timeFormat:x,lang:k,appendTo:h,scrollDefaultNow:!0}).on("timeFormatError",b.proxy(function(){var a=c();this.ui.startTime.val(a.format("LT"))},this)).on("change",b.proxy(function(){var a;!this.ui.endTime.val()&&this.ui.startTime.val()&&(a=c(this.ui.startTime.val(),"LT",!0),
a.add("hours",2),this.ui.endTime.val(a.format("LT")))},this));this.ui.endTime.timepicker({timeFormat:x,lang:k,appendTo:h}).on("timeFormatError",b.proxy(function(){var a=this.ui.startTime.val();a?(a=c(a,"LT",!0),a.add("hours",2)):a=c();this.ui.endTime.val(a.format("LT"))},this));b.ajax({url:e.getPortletResourceUri(this.options.portletId,this.membersWithOwnerActionName)+(this.model.isNew()?"":"&id="+this.model.id)}).done(b.proxy(function(a){this.ui.owner.select2({allowClear:!0,data:a,formatResult:this.memberTemplate(),
escapeMarkup:function(a){return a}})},this));b.ajax({url:e.getPortletResourceUri(this.options.portletId,this.membersActionName)}).done(b.proxy(function(a){this.ui.participants.select2({multiple:!0,data:a,formatResult:this.memberTemplate(),formatSelection:this.participantTemplate(),escapeMarkup:function(a){return a}})},this))},handleErrors:function(a,b){y(a,b,this.$el,this.i18n)},templateHelpers:{mapUrl:function(a){return w(a)},datePickerValue:function(a){return c(a).isValid()?c(a).format("L"):""},
timePickerValue:function(a){return c(a).isValid()?"00:00"===c(a).format("LT")||"12:00 AM"===c(a).format("LT")?"":c(a).format("LT"):""}},showMapLink:function(a){this.typingTimer&&window.clearTimeout(this.typingTimer);this.typingTimer=window.setTimeout(b.proxy(function(){var c=w(a.currentTarget.value);if(!this.$mapLink&&(this.$mapLink=this.$el.find("[data-fn-map-link]"),!this.$mapLink.length)){var e='<span class="help-block"><i class="halflings-icon icon-map-marker"></i> <a data-fn-map-link class="sv-map-link" target="_blank" href="'+
c+'">'+this.i18n("map")+"</a></span>";this.$mapLink=b(e).insertAfter(a.currentTarget).find("[data-fn-map-link]")}a.currentTarget.value?this.$mapLink.closest(".help-block").show():this.$mapLink.closest(".help-block").hide();this.$mapLink.attr("href",c)},this),1E3)},toggleTimeVisibility:function(){this.ui.startTime.toggleClass("sv-hidden");this.ui.endTime.toggleClass("sv-hidden")},setAndSaveForRestore:function(a,b){this.originalValues[a]||(this.originalValues[a]=this.model.get(a));this.model.set(a,
b)},restoreChanges:function(){var a=this;b.each(this.originalValues,function(b,c){a.model.set(b,c)})},setAndSaveDateForRestore:function(a,b,e){b.length?(b=c(b,"L",!0),e=c(e,"LT",!0),b.hours(e.hours()).minutes(e.minutes()),this.setAndSaveForRestore(a,b.valueOf())):this.setAndSaveForRestore(a,"")},saveChanges:function(){var a=this;this.$el.find("[data-fn-standard-value]").each(function(){a.setAndSaveForRestore(this.name,b.trim(this.value))});var c=this.ui.allDay.prop("checked");this.setAndSaveForRestore("allDay",
c);var c=b.trim(this.ui.startDate.val()),e=b.trim(this.ui.startTime.val());this.setAndSaveDateForRestore("start",c,e);c=b.trim(this.ui.endDate.val());e=b.trim(this.ui.endTime.val());this.setAndSaveDateForRestore("end",c,e);c=this.ui.isDone.prop("checked");this.setAndSaveForRestore("isDone",c);var k=this.model.isNew();this.model.save(null,{wait:!0,success:function(c){a.backingModel.set(c.attributes);b(".modal").modal("hide");k?h.trigger(h.types.activityCreated,c.attributes):h.trigger(h.types.activityUpdated,
c.attributes)},error:function(){b(".alert").show()}})}}),t=k.View.extend({template:function(){return e.getTemplate(this.options.$portlet,this.templateName)},events:{"click [data-fn-more]":"more","click [data-fn-remove]":"removeActivity","click [data-fn-edit]":"editActivity","mouseenter [data-participants]":"showParticipants","mouseleave [data-participants]":"hideParticipants"},initialize:function(a){this.options=a;a=this.template();var c=b.extend(this.model.toJSON(),this.templateHelpers());u=this.options.i18n;
this.$el.append(a(c));u=null;this.ui={description:this.$el.find("[data-fn-description]"),more:this.$el.find("[data-fn-more-remainder]"),participants:this.$el.find("[data-participants]")}},render:function(){var a=b("<div/>").text(this.model.get("title")).html(),c=C(this.options.$target);h.trigger(h.types.popoverCreated,this);this.options.$target.popover({html:!0,title:'<button type="button" class="close">&times;</button>'+a,placement:c,content:this.el,trigger:"manual",container:this.options.popoverContainer}).popover("show");
a=this.$el.closest(".popover");if(this.options.jsEvent){var e=this.options.jsEvent.pageY;if("top"===c)e-=a.height()+10;else if("left"===c||"right"===c)e-=a.height()/2;a.css({top:e})}a.on("click",".close",b.proxy(this.closePopover,this)).on("clickoutside",b.proxy(this.closePopover,this));b(document).on("keydown",b.proxy(this.closePopoverOnEscape,this));b("[data-fn-request-focus]").focus();h.on(h.types.popoverCreated,b.proxy(this.closePopoverWhenOtherIsCreated,this));return this},templateHelpers:function(){var a=
{maxSizeText:function(a){a=b("<div/>").text(a).html();if(150>a.length)return a;var c="<span>"+a.substring(0,150)+'</span><span data-fn-more class="sv-more">&nbsp;...'+u("more")+" &raquo;</span>";return c+='<span data-fn-more-remainder class="sv-hidden">'+a.substring(150)+"</span>"},mapUrl:function(a){return w(a)}};this.templateHelpers2&&(a=b.extend(a,this.templateHelpers2));return a},showParticipants:function(){var a=this.model.get("participants");a&&0<a.length&&(this.participants?this.showParticipantsTooltip():
b.ajax({url:e.getPortletResourceUri(this.options.portletId,this.participantsActionName)+"&id="+this.model.id}).done(b.proxy(function(a){this.participants=a;this.showParticipantsTooltip()},this)))},showParticipantsTooltip:function(){this.ui.participants.tooltip({html:!0,title:this.participants.join("<br/>")});this.ui.participants.tooltip("show")},hideParticipants:function(){this.ui.participants.tooltip("destroy")},more:function(a){b(a.currentTarget).addClass("sv-hidden");this.ui.description.css("max-height",
this.ui.description.height()+20+"px").addClass("sv-show-scroll");this.ui.more.removeClass("sv-hidden")},closePopover:function(){h.off(h.types.popoverCreated);b(document).off("keydown",this.closePopoverOnEscape);this.$el.closest(".popover").off("click",".close",this.closePopover).off("clickoutside",this.closePopover).remove();this.options.$target.popover("destroy")},editActivity:function(){this.model.fetch({success:b.proxy(function(a){this.createEditView(a).render();s&&b(window).scrollTop(0)},this)});
this.closePopover();return!1},closePopoverWhenOtherIsCreated:function(a){this!==a&&this.closePopover()},closePopoverOnEscape:function(a){if(a.keyCode===m.KEY.ESC)return this.closePopover(),!1}}),k=k.Model.extend({defaults:{title:"",description:"",where:"",owner:"",participants:"",start:"",end:""},initialize:function(a,b){this.portletId=b.portletId},validate:function(a){var b=[];a.title||b.push({field:"title",message:"noTitle"});a.owner||b.push({field:"owner",message:"noOwner"});if(!this.allowEmptyStart&&
!a.start)b.push({field:"start",message:"noStart"});else if(a.allDay||a.end)a.start||b.push({field:"start",message:"noStart"});if(a.start&&a.end){var e=c(a.start),h=c(a.end);a.allDay&&h.isSame(e)||h.isAfter(e)||b.push({field:"end",message:a.allDay?"invalidAllDayTimePeriod":"invalidTimePeriod"})}!a.allDay&&a.start&&(a.end||b.push({field:"end",message:"noEnd"}));return b.length?b:void 0}}),y=function(a,b,c,e){a=0;var h=b.length,k;for(c.find(".control-group").removeClass("error").find(".help-block.error").remove();a<
h;a++)k=b[a],c.find('[name="'+k.field+'"]').closest(".control-group").addClass("error").find(".controls").append('<span class="help-block error">'+e(k.message)+"</span>")},C=function(a){if(s)return"bottom";var c=a.offset().top-b(window).scrollTop(),e=window.innerHeight-c;a=a.offset().left-b(window).scrollLeft();return 220<=e?"bottom":220<=c?"top":a>=window.innerWidth-a?"left":"right"},w=function(a){return"https://maps.google.se/maps?hl="+l.PageContext.userLocale+"&q="+a+"&source=calendar"};c.lang(l.PageContext.userLocale);
l.ActivityUtil={showErrors:y,calculatePopoverPlacement:C,stripYear:function(a,b){var e=""+c(a).year();return b.replace(new RegExp(e,"g"),"").replace(/  /g," ")},ActivityModel:k,ActivityDetailView:t,ActivityEditView:v}})();
(function(){function b(b){for(var c=0,e=b.length,h=[],k;c<e;c++)k=b[c],h.push({key:k,value:s(k)});return h}function l(c){c.groupTypes=b(c.groupTypes);var e=m(u(c)),h=[{text:q.i18n.getText("common","cancel")},{text:q.i18n.getText("common","ok"),skipDismiss:!0,primary:!0,callback:function(){var b=q.PortletUtil.getPortletResourceUri(c.portletId,"groupAdministration");m.ajax({type:"POST",dataType:"JSON",data:m(".sv-fn-create-group-form").serialize(),url:b,success:function(b){m(".modal").modal("hide");
location.href=b.showGroupURL},error:function(b){m(".alert").show();b=m.parseJSON(b.responseText);var a=m(".alert").find(".alert-title");a.data("orginal-title",a.text());a=m(".alert").find(".alert-message");a.data("orginal-message",a.text());a.text(s(b.type.toLowerCase()));e.find("input").first().focus().closest(".control-group").addClass("error")}})}}];q.DialogUtil.showDialog({title:s("createGroupLabel"),body:e,buttons:h,removeOnHide:!0,errorTitle:s("createGroupError"),errorMsg:s("groupAlreadyExists")})}
var m=window.$svjq,q=window.sv,e=q.KeyUtil,p=e.KEY,h={},c,k=window._sv,s=function(b,c){var e;if(!c&&h[b])return h[b];e=q.i18n.getText("portlet.util.addgrouputil",b,c);c||(h[b]=e);return e},n={success:function(){},selected:function(){},placeholder:"",groupTemplates:[],groupFolder:null,hitTemplate:k.template('<li data-group-id="<%= id %>" class="sv-clearfix <% if (isMember) { %> sv-group-member<% } %>">   <img class="sv-group-img sv-buddy-icon" src="<%= iconURL %>" />   <% if (isMember) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>   <div class="sv-group-info-container">     <h3 class="sv-group-name"><%- name %></h3>     <p>        <%= memberCount %> medlemmar     </p>   </div></li>')},
u=k.template('<form class="form-horizontal sv-fn-create-group-form">    <div class="control-group">       <label class="control-label">'+s("name")+'</label>       <div class="controls">          <input class="input-xlarge" data-fn-groupname type="text" name="name" required value="<%= name %>" />          <span class="help-block help">'+s("nameHelp")+'</span>       </div>    </div>    <div class="control-group">       <label class="control-label">'+s("description")+'</label>       <div class="controls">          <textarea class="input-xlarge" data-fn-groupdescription data-fn-request-focus rows="3" type="text" name="description"></textarea>          <span class="help-block help">'+
s("descriptionHelp")+'</span>       </div>    </div>    <% if (templates.length > 1) { %>    <div class="control-group">       <label class="control-label">'+s("template")+'</label>       <div class="controls">          <select name="template">            <% for(var idx in templates) { %>               <option value="<%= templates[idx].id %>"><%= templates[idx].name %></option>            <% } %>          </select>          <span class="help-block help">'+s("templateHelp")+'</span>       </div>    </div>    <% } else { %>    <input type="hidden" name="template" value="<%= templates[0].id %>">    <% } %>    <div class="control-group">       <label class="control-label">'+
s("type")+'</label>       <div class="controls">          <select name="type">            <% for(var idx in groupTypes) { %>               <option value="<%= groupTypes[idx].key %>"><%= groupTypes[idx].value %></option>            <% } %>          </select>          <span class="help-block help">'+s("typeHelp")+"</span>       </div>    </div> </form>");q.AddGroupUtil={showSearchPopover:function(b){var h=m.extend({},n,b),k=m(h.target),u=0;if(k.hasClass("sv-fn-popover-showing"))k.popover("destroy").removeClass("sv-fn-popover-showing");
else{b='<form class="form-search" onsubmit="return false;"><input type="text" placeholder="'+(h.placeholder||"")+'" data-fn-group-search class="span2 search-query"/></form>';h.groupFolder&&(b='<form class="form-search" onsubmit="return false;"><div class="input-append"><input type="text" placeholder="'+(h.placeholder||"")+'" data-fn-group-search class="span1 search-query"/><button type="button" class="btn btn-small sv-fn-create-group">'+s("createGroup")+"</button></div></form>");k.popover("destroy").addClass("sv-fn-popover-showing").popover({html:!0,
title:b,placement:"bottom",content:'<ul class="sv-group-search-list sv-defaultlist"></ul>',trigger:"manual"});k.popover("show");var w=function(a){m(a.target).is(".popover *")||(k.popover("destroy").removeClass("sv-fn-popover-showing"),m("body").unbind("click",w))};m("body").bind("click",w);k.parent().find("[data-fn-group-search]").focus().closest(".popover").addClass("sv-groupsearch-popover");k.parent().find(".popover").on("click",".sv-fn-create-group",function(){l({name:k.parent().find("[data-fn-group-search]").val(),
folder:h.groupFolder,templates:h.groupTemplates,groupTypes:h.groupTypes,portletId:h.portletId})});var a=k.parent().find(".popover-content").find("ul"),z=[];k.parent().find("[data-fn-group-search]").keydown(function(b){b=e.getKeyCodeFromEvent(b);if(b===p.DOWN)return u++,u>z.length-1&&(u=0),a.children().removeClass("active").eq(u).addClass("active"),!1;if(b===p.UP)return u--,0>u&&(u=z.length-1),a.children().removeClass("active").eq(u).addClass("active"),!1}).keyup(function(b){b=e.getKeyCodeFromEvent(b);
if(b===p.ESC)return k.popover("destroy"),!1;if(b===p.RETURN){if("undefined"!==typeof z[u])return k.popover("destroy"),h.selected&&h.selected.call(this,z[u]),!1;-1===u&&l({name:m(this).val(),folder:h.groupFolder,template:h.groupTemplate,groupTypes:h.groupTypes,portletId:h.portletId})}else{if(e.isNonTextModifiableKeyCode(b))return!1;var n=this;c&&clearTimeout(c);c=setTimeout(function(){u=-1;a.empty();var b=m(n).val();m.ajax({url:q.PortletUtil.getModelObjectUri(q.PageContext.pageId,"groupSearch",q.PageContext.pageId),
data:{term:b},dataType:"json"}).done(function(b){b.queryString===m(n).val()&&(u=0,a.empty(),z=b.hits,m.each(z,function(b,c){var e=m(h.hitTemplate(c));a.append(e);e.click(function(){k.popover("destroy");h.selected&&h.selected.call(this,c);return!1}).mouseenter(function(){a.children().removeClass("active");u=b;m(this).addClass("active")})}),h.success&&h.success.call(this,z))})},200)}})}}}})();
window.$svjq(function(){function b(b){c=window.setTimeout(function(){if(p&&0<k.length){var b=k[k.length-1];k=["0"];m.ajax({method:"PUT",url:"/modelobjectapi/1/"+e.pageId+"/"+e.pageId+"/groupViewed/"+e.pageId,data:JSON.stringify({uuid:b})}).success(function(){q.trigger(q.types.groupPageViewed)}).fail(function(b){switch(b.status){case 401:case 403:p=!1}})}c=void 0},b||h)}var l=window.sv,m=window.$svjq,q=l.Events,e=l.PageContext,p=!0,h=1E3*e.userIdentityReadTimeout,c,k=["0"];e&&e.pageId&&e.pageId.match("^704\\.")&&
(b(),q.on("server-group-updated-"+e.pageId,function(e){k.push(e.uuid);c?window.setTimeout(function(){window.clearTimeout(c);b(h/2)},h/2):b()}))});
(function(){var b=window.$svjq,l=window.sv,m=l.Log,q=l.Events,e=window._sv.template('<i class="halflings-icon thumbs-up"></i><b><%= likeText %></b> (<%= likeCount %>)'),p={},h=function(b){return p[b]?p[b]:l.i18n.getText("portlet.util.likableutil",b)},c=function(b){var c=b.data("like-count")||0,k=!!b.data("user-likes");b.html(e({likeText:k?h("likes"):h("like"),likeCount:c,userLikes:k}));b[k?"addClass":"removeClass"]("sv-liked")},k=function(e){e=e||b("body");e.is("[data-fn-likable],[data-fn-portlet-likable]")?
c(e):e.find("[data-fn-likable],[data-fn-portlet-likable]").each(function(){c(b(this))})},s=function(b,c){b.tooltip({html:!0,title:c.join("<br/>")});b.tooltip("show")},n=function(){var e=b(this),h=!!e.data("user-likes"),k=e.data("likable-id"),n;e.removeData("likes");e.tooltip("destroy");if(!k)m.warn("Trying to like object without likable-id in portlet "+e.closest(".sv-portlet").attr("id"));else if(!e.hasClass("sv-disabled"))return e.addClass("sv-disabled"),n=e.closest(".sv-portlet"),n=l.ObjectUtil.getObjectId(n.attr("id")),
n=h?l.PortletUtil.getPortletResourceUri(n,"unlike")+"&likable="+k:l.PortletUtil.getPortletResourceUri(n,"like"),b.ajax({url:n,method:h?"DELETE":"POST",dataType:"JSON",data:{likable:k}}).done(function(b){e.data("user-likes",!h).data("like-count",b.count);c(e)}).fail(function(b){l.ErrorUtil.handleAjaxFailure(b)}).always(function(){e.removeClass("sv-disabled")}),!1};l.LikableUtil={toggleLike:n};b("body").on("click.likeable","a[data-fn-likable]",n);b(document).on("mouseenter",".sv-like",function(){var c=
b(this),e=c.closest(".sv-portlet"),e=l.ObjectUtil.getObjectId(e.attr("id")),h=c.data("likable-id"),k=c.data("likes");0<c.data("like-count")&&(k?s(c,k):(e=l.PortletUtil.getPortletResourceUri(e,"likes")+"&likable="+h,b.ajax({url:e,method:"GET",dataType:"JSON"}).done(function(b){c.data("likes",b);s(c,b)}).fail(function(b){l.ErrorUtil.handleAjaxFailure(b)})))});b(document).on("mouseleave",".sv-like",function(){b(this).tooltip("destroy")});q.on(q.types.updateLikables,k);k()})();
(function(){var b=window.sv,l=window.$svjq,m=b.Events,q={},e=function(c){return q[c]?q[c]:b.i18n.getText("portlet.util.oembed",c)},p=function(c,m){function n(b){var c=document.createElement("a");c.href=b;b=c.hostname.split(".");c=b.length;b=1<c?b[c-2]:void 0;return b&&-1<p.indexOf(b)}function u(b){b="string"===typeof b?l(b):b;var c,a;if(b instanceof l){if("IFRAME"===b.prop("tagName")&&n(b[0].src))return l('<div class="sv-iframeEmbed-16_9" />').append(b);if(b.find("iframe").length&&n(b.find("iframe")[0].src))return b.find("iframe").wrap('<div class="sv-iframeEmbed-16_9" />'),
b;c=b.find("embed");if(c.length&&n(c[0].src))return a=c[0].src,a=a.replace(/autoPlay=true/ig,"autoPlay=false").replace(/autostart=yes/ig,"autostart=no"),0>a.indexOf("autostart")&&0>a.indexOf("autoPlay")&&(a=a+(0<a.indexOf("?")?"&":"?")+"autoPlay=false&autostart=no"),c.attr("src",a).wrap('<div class="sv-iframeEmbed-16_9" />'),b}}c=c||l(".sv-timeline-portlet, .sv-fileshareall-portlet, .sv-embeddedmedia-portlet, .sv-timelineentry-portlet");var p=["youtube","vimeo","wistia","bambuser"],q,y=!1;c.find("a.embed:not(.embedded)").each(function(){var c=
l(this),k=c.parent(),a=c.parent().find(".embed-progress"),n={maxWidth:c.data("max-width")||"425",maxHeight:c.data("max-height")||"355",embedMethod:c.data("embed-method")||"after",includeHandle:c.data("include-handle")||!1,elementSelector:c.data("element-selector")||".sv-message-content",onError:function(b){c.data("display-error")&&c.after(l("<p>"+e("contentNotFound")+' <a href="'+b+'">'+b+"</a></p>"));a.hide()},ajaxOptions:{timeout:5E3},afterEmbed:function(a){a.code?y||(a=l(this).parent().parent(),
h(a,0,0)):c.data("display-error")&&k.append(l("<p>"+e("contentNotFound")+' <a href="'+this.href+'">'+this.href+"</a></p>"))}};q=function(a){if(null!==a){var b=a.code?u(a.code):"";y=!!b;a.code=y?b:a.code;var b=this.closest(n.elementSelector),b=0<b.length?b.first():this.parent(),c;c=y?'<div class="oembedall-container no-max-height"></div>':'<div class="oembedall-container"></div>';"auto"===n.embedMethod&&null!==k.attr("href")?n.embedMethod="append":"auto"===n.embedMethod&&(n.embedMethod="replace");
switch(n.embedMethod){case "replace":this.replaceWith(a.code);break;case "fill":this.html(a.code);break;case "after":c=l(c);b.after(c);try{a.code.clone().appendTo(c)}catch(e){c.append(a.code)}break;case "append":this.wrap(c);b=this.parent();n.includeHandle&&l('<span class="oembedall-closehide">&darr;</span>').insertBefore(this).click(function(){var a=encodeURIComponent(l(this).text());l(this).html("%E2%86%91"===a?"&darr;":"&uarr;");l(this).parent().children().last().toggle()});b.append("<br/>");try{a.code.clone().appendTo(b)}catch(h){b.append(a.code)}}}};
m&&m.onEmbed||(n.onEmbed=q);n=l.extend(n,m);if(!c.hasClass("embedded"))try{c.addClass("embedded").oembed(null,n)}catch(p){b.Log.error("oembedutil","Could not embed link. Error: "+p.message)}})},h=function(b,e,n){setTimeout(function(){if(c(b)){var m=b.find(".oembedall-container").addClass("show-expand");m.css({width:"100%",maxWidth:"100%"});b.on("click",function(b){330<b.offsetY&&(b.preventDefault(),m.css({"max-height":"none"}),m.removeClass("show-expand"),l(this).off("click"))})}else 6E3>n&&(n+=e,
h(b,2E3,n))},e)},c=function(b){b=b.find(".oembedall-container");var c=b.outerHeight();return b.children().first().outerHeight()>c};m.on(m.types.updateOembedLinks,p);p()})();
(function(){var b=window.$svjq,l=window.moment,m=window.sv.Events,q=b("html").attr("lang")||"en",e=function(e){e=e||b("body");e.find("time[data-fn-relative-date]").each(function(){var e=b(this),c=e.attr("datetime"),k=e.data("short");l.lang(k?q+"-short":q);if(c=l(c))e.text(c.fromNow()),e.attr("title",c.format("LLLL"))})};window.setInterval(e,6E4);m.on(m.types.updateRelativeDates,e);e()})();
(function(){var b=window.$svjq,l=window.sv,m=l.PortletUtil,q=l.KeyUtil,e=q.KEY,p={},h,c=window._sv,k={success:function(){},selected:function(){},placeholder:"",markAdmins:!1,hitTemplate:c.template('<li data-user-identity="<%= id %>" class="sv-clearfix">   <img class="sv-contact-img sv-buddy-icon" src="<%= iconURL %>" />   <% if ((typeof(isMember) !== \'undefined\' && isMember) || (typeof(isAdmin) !== \'undefined\' && isAdmin) || (typeof(isContact) !== \'undefined\' && isContact)) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>   <div class="sv-user-info-container">     <h3 class="sv-contact-name"><%= name %></h3>     <p>     <% _.each(userfields, function(field) { %>        <%= field.value %><br/>     <% }); %>     </p>   </div></li>'),
adminHitTemplate:c.template('<li data-user-identity="<%= id %>" class="sv-clearfix">   <img class="sv-contact-img sv-buddy-icon" src="<%= iconURL %>" />   <% if ((typeof(isAdmin) !== \'undefined\' && isAdmin)) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>   <div class="sv-user-info-container">     <h3 class="sv-contact-name"><%= name %></h3>     <p>     <% _.each(userfields, function(field) { %>        <%= field.value %><br/>     <% }); %>     </p>   </div></li>')},s=
function(b,c){var e;if(!c&&p[b])return p[b];e=l.i18n.getText("portlet.util.searchuserutil",b,c);c||(p[b]=e);return e};l.SearchUserUtil={showSearchPopover:function(c){var p=b.extend({},k,c),v=b(p.target),t=0;if(v.hasClass("sv-fn-popover-showing"))b(".popover").remove(),v.removeClass("sv-fn-popover-showing");else{b(".popover").remove();v.addClass("sv-fn-popover-showing").popover({html:!0,container:0<v.closest(".modal").length?v.closest(".modal"):!1,title:'<input type="text" placeholder="'+(p.placeholder||
"")+'" data-fn-user-search class="input-medium search-query"/>',placement:"bottom",content:'<ul class="sv-user-search-list sv-defaultlist"></ul>',trigger:"manual"});v.popover("show");var y=function(a){b(a.target).is(".popover *")||(b(".popover").remove(),v.removeClass("sv-fn-popover-showing"),b("body").unbind("click",y))};b("body").bind("click",y);b("[data-fn-user-search]").focus().closest(".popover").addClass("sv-usersearch-popover");var C=m.getModelObjectUri(l.PageContext.pageId,"userIdentitySearch",
l.PageContext.pageId)+"?userfields=true",w=b(".popover-content").find("ul"),a=[];p.group&&(C+="&group="+p.group);p.userIdentity&&(C+="&identity="+p.identity);w.css("max-height",window.innerHeight-w.offset().top-10+"px");b("[data-fn-user-search]").keydown(function(b){b=q.getKeyCodeFromEvent(b);if(b===e.DOWN){t++;if(p.searchUrl&&t>a.length||!p.searchUrl&&t>a.length-1)t=0;w.children().removeClass("active").eq(t).addClass("active");return!1}if(b===e.UP)return t--,0>t&&(t=p.searchUrl?a.length:a.length-
1),w.children().removeClass("active").eq(t).addClass("active"),!1}).keyup(function(c){c=q.getKeyCodeFromEvent(c);if(c===e.ESC)return b(".popover").remove(),v.removeClass("sv-fn-popover-showing"),!1;if(c===e.RETURN){if(t===a.length)return 0<t&&"undefined"!==typeof w.children().eq(t).find("a").attr("href")?location.href=w.children().eq(t).find("a").attr("href"):""!==b(this).val()&&(location.href=p.searchUrl+"&query="+b(this).val()),!1;if("undefined"!==typeof a[t])return b(".popover").remove(),v.removeClass("sv-fn-popover-showing"),
p.selected&&p.selected.call(this,a[t]),!1}else{if(q.isNonTextModifiableKeyCode(c))return!1;var k=this;h&&clearTimeout(h);h=setTimeout(function(){t=0;w.empty();var c=b(k).val();""!==c&&b.ajax({url:C,dataType:"json",data:{term:c}}).done(function(e){e.queryString===b(k).val()&&(t=0,w.empty(),a=e.hits,b.each(a,function(a,c){var e=p.markAdmins?b(p.adminHitTemplate(c)):b(p.hitTemplate(c));w.append(e);e.click(function(){b(".popover").remove();v.removeClass("sv-fn-popover-showing");p.selected&&p.selected.call(this,
c);return!1}).mouseenter(function(){w.children().removeClass("active");t=a;b(this).addClass("active")})}),p.searchUrl&&0<a.length&&(e=s("showAll"),10>a.length&&(e=s("showAsList")),b('<li class="sv-showmore"><a href="'+p.searchUrl+"&query="+c+'">'+e+"</a></li>").appendTo(w).mouseenter(function(){w.children().removeClass("active");t=a.length}).click(function(){location.href=b(this).find("a").attr("href");return!1}),t=a.length),w.children().eq(t).addClass("active"),p.success&&p.success.call(this,a))})},
200)}})}}}})();
(function(){function b(b,c){var e;if(!c&&k[b])return k[b];e=m.i18n.getText("portlet.util.userinformation",b,c);c||(k[b]=e);return e}function l(b){var k=b.data("user-identity"),l=b.data("fn-show-user-popup-subtitle"),l=e.escape(b.attr("title"))+(l?"<small> "+e.escape(l)+"</small>":""),k=h.getModelObjectUri(m.PageContext.pageId,"userStatus",k);b.addClass("user-popover-loaded").webuiPopover({trigger:"hover",delay:300,type:"async",title:l,placement:"auto",url:k,content:function(b){b=JSON.parse(b);c.extend(b,
{showAddContact:b.userIdentityAvailable&&b.requestedUserIdentityAvailable,showSendMessage:b.userIdentityAvailable&&b.requestedUserIdentityAvailable&&0<c(".sv-messages-portlet").length});return(new n({model:new s(b)})).getContent()}})}var m=window.sv,q=window.SVBackbone,e=window._sv,p=m.Events,h=m.PortletUtil,c=window.$svjq,k={},s=q.Model.extend({defaults:{fields:[],contacts:0,groups:0,showSendMessage:!1},url:function(){return h.getModelObjectUri(m.PageContext.pageId,"userStatus",this.id)}}),n=q.View.extend({tagName:"div",
className:"bootstrap",template:e.template('<div class="bootstrap"><img style="float:left; margin-right:8px;" class="sv-buddy-icon" src="<%= largeBuddyIcon %>" /><div style="overflow: hidden" class="sv-userfields">    <% _.each(fields, function(field) { %>       <%- field %><br/>    <% }); %></div><div style="clear:left; padding-top:10px; margin-bottom:3px" class="sv-clearfix">    <div style="float:left;margin-top: 7px;"><img src="/sitevision/core/<%= status %>.png"/></div>       <div style="float:left;margin-top: 4px;"><small><%= statusText %></small></div>       <div style="float:right;padding-left: 10px;">         <% if (showAddContact && contact === \'false\') { %>           <button data-user-identity="<%= id %>" class="btn btn-mini btn-default sv-add-contact">'+
b("addAsContact")+'</button>         <% } %>         <% if (showSendMessage && self === \'false\') { %>           <button data-user-identity="<%= id %>" class="btn btn-mini btn-primary sv-send-message"><i class="halflings-icon comments white"></i> '+b("message")+"</button>         <% } %>       </div>    </div></div>"),getContent:function(){return this.template(this.model.toJSON())}});c("body").on("mouseenter","[data-user-identity][data-fn-show-user-popup]",function(){var b=c(this);b.hasClass("user-popover-loaded")||
(l(b),b.trigger("mouseenter"))});c("body").on("click","button.sv-send-message[data-user-identity]",function(){var b=c(this);p.trigger("sendMessage",b.data("user-identity"));b.closest("[data-user-identity][data-fn-show-user-popup]").webuiPopover("hide");return!1});c("body").on("click","button.sv-add-contact[data-user-identity]",function(){var b=c(this);c.post(h.getModelObjectUri(m.PageContext.userIdentityId,"addContact"),{id:b.data("user-identity")});c('[data-user-identity="'+b.data("user-identity")+
'"][data-fn-show-user-popup]').removeClass("user-popover-loaded").webuiPopover("destroy");return!1})})();
(function(){function b(b){b=b.serializeArray();var c={};e.each(b,function(b,e){c[e.name]=e.value});return c}var l=window.sv,m=l.PortletUtil,q=l.DialogUtil,e=window.$svjq,p=function(b){return l.i18n.getText("portlet.social.userfields.userfields",b)},h=function(b){return l.i18n.getText("common",b)},c=function(b){var c=!0;"function"===typeof b.checkValidity&&(c=b.checkValidity());return c};l.UserSettingsUtil={popupUserSettingsDialog:function(k){var s=e("<div/>").addClass("sv-userfields-content"),n=e("<form/>").addClass("form-horizontal sv-userfields-form");
s.append(n);e.ajax({type:"GET",dataType:"json",url:m.getModelObjectUri(l.PageContext.userIdentityId,"userfields",l.PageContext.userIdentityId),data:{fields:k||"all"},success:function(k){e.each(k.fields,function(b,c){var h=e("<div/>").addClass("control-group");n.append(h);var a=e("<label/>").addClass("control-label").text(c.name);h.append(a);a=e("<div/>").addClass("controls");h.append(a);"true"===c.writeable?"text_field"===c.type?(h=e("<textarea/>").attr({rows:"3",id:c.id,name:c.id,"data-errorMsg":c.validationErrorMessage}).addClass("input-xlarge"),
"no_validation"!==c.validationType&&("reg_exp_validation"===c.validationType&&c.regularExpression&&h.attr("pattern",c.regularExpression),c.value&&h.attr("required",""),h.attr("data-validation","true")),a.append(h),c.value&&h.val(c.value)):(h=e("<input/>").attr({type:c.type,id:c.id,name:c.id,"data-errorMsg":c.validationErrorMessage}).addClass("input-xlarge"),"no_validation"!==c.validationType&&("reg_exp_validation"===c.validationType&&c.regularExpression&&h.attr("pattern",c.regularExpression),c.value&&
h.attr("required",""),h.attr("data-validation","true")),a.append(h),c.value&&h.val(c.value),c.description&&(h=e("<span/>").addClass("help-block help").text(c.description),a.append(h))):c.value&&a.append(e("<label/>").attr({title:c.description}).css("padding-top","5px").text(c.value))});if(k.passwordRequired){var v=e("<div/>").addClass("control-group").addClass("well");n.append(v);var t=e("<label/>").addClass("control-label").text(p("password_field_title"));v.append(t);t=e("<div/>").addClass("controls");
v.append(t);v=e("<input/>").attr({id:"password",name:"password",type:"password"}).addClass("input-xlarge");t.append(v);v=e("<span/>").addClass("help-block help").text(p("password_field_description"));t.append(v)}n.find("input").not('[type="password"]').on("keyup",function(b){b=e(b.target);b.val().length&&b.attr("data-validation")?b.attr("required","required"):b.removeAttr("required")});t=[{text:h("cancel")},{text:h("ok"),skipDismiss:!0,primary:!0,callback:function(){e(".help-block").remove(".error");
e(".help-block").remove(".serverside-error");e(".control-group").removeClass("error");e(".alert").hide();if(c(n.get(0))){var q=b(n);e.ajax({type:"PUT",dataType:"JSON",url:m.getModelObjectUri(l.PageContext.userIdentityId,"userfields",l.PageContext.userIdentityId),data:JSON.stringify(q),processData:!1,success:function(b){if(b.success)m.reloadPortletsByType(".sv-userfields-portlet"),m.reloadPortletsByType(".sv-profileprogress-portlet"),e(".modal").modal("hide");else if(b.serverError){var a=e(".alert");
a.show();a.find(".alert-title").text(h("error"));a.find(".alert-message").text(p(b.serverError));"wrong_password"===b.serverError&&(b=s.find("#password"),b.parents(".control-group").addClass("error"),b.focus())}else e.each(b.failedFields,function(a,b){var c=e("#"+b);c.parents(".control-group").addClass("error");c.nextAll(".serverside-error").length||(c.nextAll(".help-block.error").remove(),c.after(e("<span/>").addClass("help-block help serverside-error").text(c.attr("data-errorMsg"))))})},error:function(){e(".alert").show()}})}else{var v=
e("#password");v.length&&!c(v.get(0))&&(v.get(0).focus(),v.parents(".control-group").addClass("error"),e(".alert").show(),e(".alert").find(".alert-title").text(h("error")),e(".alert").find(".alert-message").text(p("wrong_password")));e.each(k.fields,function(b,a){v=e("#"+a.id);"true"!==a.writeable||c(v.get(0))||(v.get(0).focus(),v.parents(".control-group").addClass("error"),v.nextAll(".serverside-error, .error").length||v.after(e("<span/>").addClass("help-block help error").text(v.attr("data-errorMsg"))))})}}}];
q.showDialog({title:p("dialogTitle"),body:s,buttons:t,removeOnHide:!0,errorTitle:p("errorTitle"),errorMsg:p("errorMsg")})}})}}})();
(function(){var b=window.$svjq,l=window.sv.Events,m=window.LazyLoad,q,e=function(b){q?b.call():(m.css("/sitevision/ajax/jquery/plugins/videojs/video-js.css"),m.js("/sitevision/ajax/jquery/plugins/videojs/video.js",function(){q=!0;window.videojs.options.flash.swf="/sitevision/ajax/jquery/plugins/videojs/video-js.swf";b.call()}))},p=function(h){h=h||b(".sv-timeline-portlet, .sv-video-portlet, .sv-timelineentry-portlet");h.find("video:not(.sv-video-js-loaded)").each(function(){var c=b(this);e(function(){c.addClass("sv-video-js-loaded");
window.videojs(c.get(0),{width:"auto",height:"auto"})})})};l.on(l.types.updateVideoLinks,p);p()})();(function(){window.sv.WindowLocationUtil={setHashValue:function(b,l){window.location.hash="#"+b+"/"+l},getHashValue:function(b){var l=window.location.hash,m=2+b.length;if(0===l.indexOf("#"+b+"/")&&l.length>m)return l.substring(m)},clearHashValue:function(){window.location.hash=""},hasHashValue:function(){var b=window.location.hash;return 0===b.indexOf("#")&&1<b.indexOf("/")},reloadPage:function(){location.reload()}}})();
(function(){var b=window.$svjq,l=window.sv.i18n,m=window.sv,q=m.PortletUtil,e=m.ClientUtil,p=m.Ajax;b(".sv-archive-portlet").on("click",".sv-create-article-entry",function(){var h=b(this),c=h.data("archive-id"),k=h.data("template-id"),m=h.data("use-new-editor"),h=h.parent(),n=b("<div>").addClass("sv-loading-icon").text(l.getText("portlet.archive.archive","creatingArticle"));h.empty().append(n);p.doPost({url:q.getEditApiUri({objectId:c,contextNodeId:c,modelHandler:"article"}),data:{template:k,portletType:"archive"},
success:function(b){window.location.href=m||e.isMobileDevice?"/edit/"+b.nodeId:"/editor/index.jsp?objectId="+b.nodeId}});return!1})})();
(function(){var b=window.$svjq,l=window.sv.i18n,m=window.sv,q=m.PortletUtil,e=m.ClientUtil,p=m.Ajax;b(".sv-blog-portlet").on("click",".sv-create-blog-entry",function(){var h=b(this),c=h.data("archive-id"),k=h.data("template-id"),m=h.data("use-new-editor"),h=h.parent(),n=b("<div>").addClass("sv-loading-icon").text(l.getText("portlet.blog.blog","creatingBlogEntry"));h.empty().append(n);p.doPost({url:q.getEditApiUri({objectId:c,contextNodeId:c,modelHandler:"article"}),data:{template:k,portletType:"blog"},
success:function(b){window.location.href=m||e.isMobileDevice?"/edit/"+b.nodeId:"/editor/index.jsp?objectId="+b.nodeId}});return!1})})();
(function(){function b(b){var c=b.find("[data-comments2-entry]");l(b);if(0!==c.length){var h=e.getObjectId(b.attr("id")),n=c.data("js-namespace"),p=c.data("profilepageurl"),c=c.data("tagresultpageurl"),s=new a(m[n].comments||[],{id:h,portletId:h});u=m[n].maxCharacterCount;v=m[n].useCaptcha;new B({el:b,collection:s,commentTemplate:q.getTemplate(b,"comments2-comment"),portletId:h,profilePageURL:p,tagResultPageURL:c});h=b.find(".sv-comments2-comments");0<h.length&&(y(h,p),C(h,c));p=k.cookie("fullName");
null!==p&&0<p.length&&b.find("[data-fn-comments2-input-name]").val(p);b.find(".sv-comment-hidden").attr("title",t("hiddenComment"))}}function l(a){var c=e.getObjectId(a.attr("id"));a.off("click","[data-fn-comment2-toggle-close]");a.on("click","[data-fn-comment2-toggle-close]",function(e){e.preventDefault();e=q.getPortletUri(c,"toggleVisible");k.get(e,function(c){a.find(".sv-comments2-portlet-content").html(c);b(a)})});a.off("click","[data-fn-comment2-toggle-mutable]");a.on("click","[data-fn-comment2-toggle-mutable]",
function(b){b.preventDefault();b=q.getPortletUri(c,"toggleMutable");k.get(b,function(){a.find("[data-sv-comments2-closed-title]").hasClass("sv-hidden")?(a.find("[data-sv-comments2-closed-title]").removeClass("sv-hidden"),a.find(".sv-comments2-form").addClass("sv-hidden"),a.find("[data-sv-comments2-disallow-comments]").addClass("sv-hidden"),a.find("[data-sv-comments2-allow-comments]").removeClass("sv-hidden")):(a.find("[data-sv-comments2-closed-title]").addClass("sv-hidden"),a.find(".sv-comments2-form").removeClass("sv-hidden"),
a.find("[data-sv-comments2-disallow-comments]").removeClass("sv-hidden"),a.find("[data-sv-comments2-allow-comments]").addClass("sv-hidden"))})})}var m=window.sv,q=m.PortletUtil,e=m.ObjectUtil,p=m.Events,h=m.KeyUtil,c=h.KEY,k=window.$svjq,s=window.SVBackbone,n={},u,v,t=function(a,b){var c;if(!b&&n[a])return n[a];c=m.i18n.getText("portlet.comments2.comments",a,b);b||(n[a]=c);return c},y=function(a,b){a.find("a[data-user-identity]").each(function(){var a=k(this);a.attr("href",b+"?identity="+a.data("user-identity"))})},
C=function(a,b){a.find("a[data-social-tag-id]").each(function(){var a=k(this);a.attr("href",b+"?tag="+a.data("social-tag-name"))})},w=s.Model.extend({url:function(){return this.collection?this.collection.url()+"&commentId="+this.get("id"):"?commentId="+this.get("id")}}),a=s.Collection.extend({model:w,initialize:function(a,b){this.options=b;this.bindServerEvents()},bindServerEvents:function(){var a=this;p.on("server-pagecomment-added-"+m.PageContext.pageId,function(b){a.add(b.content,{append:!0})})},
url:function(){return q.getPortletResourceUri(this.options.portletId,"comment")+"&file="+this.options.id}}),z=s.View.extend({tagName:"li",className:function(){return this.model.get("hidden")?"sv-comment2-comment sv-comment-hidden":"sv-comment2-comment"},events:{"click [data-fn-destroy-comment]":"showDestroyDialog","click [data-fn-hide-comment]":"doHide","click [data-fn-show-comment]":"doHide"},initialize:function(){this.listenTo(this.model,"destroy",this.remove,this);this.listenTo(this.model,"change:hidden",
this.hide,this)},showDestroyDialog:function(){var a=this;m.DialogUtil.showConfirmDialog(t("removeCommentTitle"),t("removeCommentBody"),function(b){b&&a.model.destroy({wait:!0})});return!1},doHide:function(a){a.preventDefault();this.model.set({hidden:!this.model.get("hidden")});this.model.save()},hide:function(){this.model.get("hidden")?(this.$el.addClass("sv-comment-hidden"),this.$el.attr("title",t("hiddenComment")),this.$el.find("[data-fn-hide-comment]").addClass("sv-hidden"),this.$el.find("[data-fn-show-comment]").removeClass("sv-hidden"),
this.$el.find(".sv-comments2-hidden-comment-text").removeClass("sv-hidden")):(this.$el.removeClass("sv-comment-hidden"),this.$el.removeAttr("title"),this.$el.find("[data-fn-hide-comment]").removeClass("sv-hidden"),this.$el.find("[data-fn-show-comment]").addClass("sv-hidden"),this.$el.find(".sv-comments2-hidden-comment-text").addClass("sv-hidden"))},render:function(){this.$el.html(this.options.template(this.model.toJSON()));this.model.toJSON().hidden&&this.$el.attr("title",t("hiddenComment"));y(this.$el,
this.options.profilePageURL);C(this.$el,this.options.tagResultPageURL);return this}}),B=s.View.extend({initialize:function(){this.$list=this.$el.find("[data-fn-comments2]");this.collection.on("add",this.addNewComment,this);this.$el.find("[data-fn-comments2-input]").triggeredInput({triggers:{"@":{source:q.getModelObjectUri(m.PageContext.pageId,"userIdentitySearch",m.PageContext.pageId),searchKey:"term",allowWhiteSpace:!0,maxWhiteSpace:2,parse:function(a){return a.hits}}},minLength:2,replacer:function(a){return a.trigger+
'{"value":"'+a.name+'","id":"'+a.id+'"}'}});0<this.collection.length&&this.render()},render:function(){this.clearList();this.collection.each(function(a){this.appendOne(a)},this);p.trigger(p.types.updateRelativeDates,this.$el);p.trigger(p.types.updateLikables,this.$el);p.trigger(p.types.updateOembedLinks,this.$el)},clearList:function(){this.$list.empty()},appendOne:function(a){a=(new z({model:a,template:this.options.commentTemplate,profilePageURL:this.options.profilePageURL,tagResultPageURL:this.options.tagResultPageURL})).render().$el;
var b=a.find(".sv-comments2-content").find(".sv-truncate-more"),c;0<b.length&&(this.addShowMoreLink(b),c=!0);this.$list.append(a);c&&this.bindShowMoreEvents(a)},bindShowMoreEvents:function(a){var b=t("showMore"),c=t("showLess"),e=k(".sv-truncate-more-link",a),h=k(".sv-truncate-more",a),n=k(".sv-truncate-ellipsis",a);e.on("click",function(a){a.preventDefault();e.text()===b?(h.show(),e.text(c),n.css("display","none")):(h.hide(),e.text(b),n.css("display","inline"))})},addShowMoreLink:function(a){k('<span class="sv-truncate-ellipsis">...</span>').insertBefore(a);
k('<div><a href="#" class="sv-truncate-more-link">'+t("showMore")+"</a></div>").insertAfter(a);a.css("display","none")},addNewComment:function(a){void 0!==a.toJSON().author?this.appendOne(a):p.trigger(p.types.notifyUser,{type:"default",heading:t("moderatedHeading"),message:t("moderatedBody"),"transient":!0});p.trigger(p.types.updateRelativeDates,this.$el);p.trigger(p.types.updateLikables,this.$el)},getLoader:function(){this.$loader||(this.$loader=k('<img src="/sitevision/util/images/loading_16_grey.gif" />').css("vertical-align",
"middle").appendTo(this.$el.find("[data-fn-comment-input]").parent()));return this.$loader},events:{"focus [data-fn-comments2-input]":"expandTextfield","click [data-fn-comments2-input]":"expandTextfield","keyup [data-fn-comments2-input]":"countdownCharactersLeft","keyup [data-fn-comments2-input-name]":"countdownCharactersLeft","keydown [data-fn-comments2-input]":"checkKeyDown","submit [data-fn-comments2-form]":"postComment"},expandTextfield:function(a){k(a.currentTarget).addClass("sv-message-input-expanded");
this.$el.find(".sv-submit-controls").show();this.countdownCharactersLeft(a)},shrinkTextfield:function(){this.$el.find(".sv-message-input-expanded").removeClass("sv-message-input-expanded");this.$el.find(".sv-submit-controls").hide()},getTextField:function(){this.$textField||(this.$textField=this.$el.find("[data-fn-comments2-input]"));return this.$textField},countdownCharactersLeft:function(a){a=k(a.currentTarget);var b=a.val(),b=u-b.length,c=this.$el.find("[data-fn-comments2-input-size]");0>b?c.addClass("sv-character-limit-exceeded"):
c.removeClass("sv-character-limit-exceeded");c.text(b);""!==a.val()&&0<=b&&!this.activeConnection?this.enableSubmitButton():this.disableSubmitButton()},checkKeyDown:function(a){if(h.getKeyCodeFromEvent(a)===c.RETURN&&a.ctrlKey)return this.getSubmitButton().focus(),this.$el.find("[data-fn-comments2-form]").submit(),!1},postComment:function(a){var b=this,c,e,h,n;if(!a.isPropagationStopped()&&!a.isDefaultPrevented()){a.preventDefault();if(this.activeConnection)return!1;c=this.$el.find("[data-fn-comments2-input]");
n=b.getNameField();a=c.val().length;if(1===n.length&&0===n.val().length)return p.trigger(p.types.notifyUser,{type:"default",heading:t("noNameHeading"),message:t("noNameBody"),"transient":!0}),!1;if(0<a&&a<=u){if(v&&(e=(e=this.$el.find("#g-recaptcha-response"))&&e[0].value,!e))return this.$el.find("#sv-help-block-verify").show(),!1;this.disableSubmitButton();this.activeConnection=!0;e=new w({comment:c.triggeredInput("getRichContent"),fullName:n.val(),useCaptcha:v,recaptchaResponse:e||""});a=b.$el.find("[data-sv-spam-marker]");
0<a.length&&(e.attributes[a.attr("name")]=a.val());h=setTimeout(function(){b.getLoader().show()},400);this.collection.create(e,{wait:!0,success:function(){c.val("");b.activeConnection=!1;b.getLoader().hide();clearTimeout(h);k.cookie("fullName",n.val());v&&b.$el.find("#recaptcha-container").hide()},error:function(){b.activeConnection=!1;b.getLoader().hide();clearTimeout(h);b.enableSubmitButton();p.trigger(p.types.notifyUser,{type:"error",heading:t("postFailedHeading"),message:t("postFailedBody"),"transient":!0})}});
this.shrinkTextfield()}else a>u&&p.trigger(p.types.notifyUser,{type:"default",heading:t("commentToLongHeading"),message:t("commentToLongBody"),"transient":!0});return!1}},getSubmitButton:function(){this.$submitButton||(this.$submitButton=this.$el.find("[data-fn-comments2-submit]"));return this.$submitButton},getNameField:function(){this.$NameField||(this.$NameField=this.$el.find("[data-fn-comments2-input-name]"));return this.$NameField},disableSubmitButton:function(){this.getSubmitButton().addClass("disabled").attr("disabled",
"disabled")},nameFieldOK:function(){var a=this.getNameField();return 0===a.length||a.val()?!0:!1},enableSubmitButton:function(){""!==this.getTextField().val()&&this.nameFieldOK()&&this.getSubmitButton().removeClass("disabled").removeAttr("disabled")}});k(".sv-comments2-portlet").each(function(){var a=k(this);b(a)})})();
(function(){function b(b){this.options=b;this.bindLinkListener()}var l=window.$svjq,m=window.sv,q=/^[A-Z0-9._%+\-]+@([A-Z0-9][.\-]?)+[A-Z0-9]+\.[A-Z]{2,6}$/i;b.prototype={bindLinkListener:function(){var b=this;this.options.$portlet.find("."+this.options.linkClass).on("click",function(){b.openDialog.call(b,this);return!1})},getDialogContainer:function(){this.$dialogContainer||(this.$dialogContainer=l("<div/>"));return this.$dialogContainer},showMessageDialog:function(b){this.$subDialogContainer?this.$subDialogContainer.html(b).svDialog("open"):
this.$subDialogContainer=l("<div/>").html(b).svDialog({open:!0,title:this.options.sendMessageTitle,buttons:[{text:this.options.closeButtonText,type:"primary",callback:l.proxy(function(){this.$subDialogContainer.svDialog("close")},this)}]})},validateForm:function(){var b=!0,p=this.getDialogContainer().find("form");l.each(this.options.requiredFields,l.proxy(function(h,c){var k=p.find("[name="+c+"]");this.validateField(k)||(b=!1)},this));return b},validateField:function(b){var l=b.is("[name=emailAddress]");
if(this.checkRequiredField(b)){if(l&&!this.checkEmailAddress(b))return this.appendErrorMessage(b,this.options.errorMessages.emailInvalid),!1;this.removeValidationErrors(b);return!0}this.appendErrorMessage(b,this.options.errorMessages[b.attr("name")]);return!1},checkEmailAddress:function(b){if(0===b.length)return!0;b=b.val();return""===l.trim(b)&&-1===l.inArray("emailAddress",this.options.requiredFields)||q.test(b)},checkRequiredField:function(b){var m=!1;return-1===l.inArray(b.attr("name"),this.options.requiredFields)?
!0:m=b.is("[type=checkbox]")?b.is(":checked")||0<b.siblings("input[type=checkbox]").filter(":checked").length:!!l.trim(b.val())},appendErrorMessage:function(b,m){b.siblings(".sv-contact2-error-message-container").remove();b.addClass("sv-contact2-warned");var h=l("<label/>",{"for":b.attr("id"),"class":this.options.errorFont}).html('<img alt="" style="border:none; width:16px; height:16px; vertical-align:middle" src="'+this.options.errorImageSrc+'"/> '+m);l('<div class="sv-contact2-error-message-container" />').append(h).appendTo(b.parent())},
removeValidationErrors:function(b){(b?b.parent():this.getDialogContainer()).find(".sv-contact2-error-message-container").remove()},handleSubmit:function(){var b=this.options.ajaxFormUrl,m;this.validateForm()&&(this.options.attachmentField?this.getDialogContainer().find("form").submit():(m=this.getDialogContainer().find("form").serialize(),l.post(b,m,l.proxy(function(b){this.closeDialog();this.showMessageDialog(b)},this))))},closeDialog:function(){this.getDialogContainer().svDialog("close")},buildDialogUrl:function(b){return this.options.ajaxSendBaseUrl+
"&contactUserId="+b.substring(3).replace("_",".")},openDialog:function(b){var m=this.getDialogContainer();if(this.dialogCreated)m.svDialog("setURL",this.buildDialogUrl(b.id)).svDialog("open");else{m.svDialog({open:!0,url:this.buildDialogUrl(b.id),title:this.options.sendMessageTitle,modal:this.options.useModalDialog,buttons:[{text:this.options.submitButtonText,type:"primary",callback:l.proxy(this.handleSubmit,this)},{text:this.options.cancelButtonText,type:"link",callback:l.proxy(this.closeDialog,
this)}]});var h=this;m.on("change","input, textarea",function(){h.validateField(l(this))});m.on("keyup","input[type=text].sv-contact2-warned, textarea.sv-contact2-warned",function(){h.validateField(l(this))});this.dialogCreated=!0}}};l(".sv-contact2-portlet").each(function(){var e=l(this),p=m.contact2[this.id.substring(4)];p&&(p.$portlet=e,p=new b(p),e.data("sv-contact2-portlet",p))})})();
(function(){var b=window.$svjq,l={};b(".sv-has-error").each(function(){var l=b(this);l.on("change keyup",function(){l.removeClass("sv-has-error");l.off()})});var m=function(m){var e=m.val();m=l[m.attr("id")];e=m.initialSize-b.trim(e).length;0>e?m.$el.addClass("sv-textfield-limit-exceeded"):m.$el.removeClass("sv-textfield-limit-exceeded");m.$el.text(e)};b(".sv-form-textfield.sv-limit-characters").each(function(){var q=b(this),e=q.parent().find(".sv-textfield-input-size"),p=q.attr("id");l[p]={$el:e,
initialSize:e.text()};q.on("keyup",function(e){m(b(e.currentTarget))});q.val().length&&m(q)})})();
(function(){function b(b,m,h,c,k,q){var n=window.hs,u=l.i18n.getLanguage();if("de"===u||"no"===u||"sv"===u)n.lang=n.lang[u];n.numberingClass=b;b={interval:m,repeat:!0,useControls:!k,fixedControls:"fit"};k||(b.overlayOptions={position:"bottom right",hideOnMouseOut:c,offsetY:h,offsetX:-3});q||(b.thumbstrip={position:"above",mode:"horizontal",relativeTo:"expander"});n.addSlideshow(b)}var l=window.sv,m=window.$svjq,q=window.LazyLoad;l.ImageAlbumUtil={createSlideShow:function(e,l,h,c,k,s){window.hs?b(e,
l,h,c,k,s):(q.css("/sitevision/ajax/highslide/highslide.css"),m.getScript("/sitevision/ajax/highslide/highslide_mod.js",function(){b(e,l,h,c,k,s)}))}}})();
(function(b,l){b.sv=b.sv||{};b.sv.responsiveTables=b.sv.responsiveTables||{};b.sv.responsiveTables.config=b.sv.responsiveTables.config||{};b.sv.responsiveTables.classNames={};b.sv.responsiveTables.selectors={};l.each([["groupName",""],["scroll","--scroll"],["fixedFirst","--fixedFirst"],["stackGroupName","--stacked"],["stackTable","--stackTable"],["stackColumns","--stackColumns"]],function(l,q){b.sv.responsiveTables.classNames[q[0]]="sv-responsiveTable"+q[1];b.sv.responsiveTables.selectors[q[0]]=".sv-responsiveTable"+
q[1]});b.sv.responsiveTables.config=l.extend({},{breakpoint:"767px",fixedFirstWidth:"35%",divClassTmpl:'<div class="<%= classNames %>" />',divStyleTmpl:'<div class="<%= classNames %>" style="<%= styleAttr %>" />',tblTmpl:'<table class="<%= classNames %>"><tbody></tbody></table>',tblThRowTmpl:'<tr class="<%= trClassNames %>"><th class="<%= thClassNames %>" colspan="<%= colSpan %>"><%= content %></th></tr>',tblTrRowTmpl:'<tr class="<%= trClassNames %>"><td class="<%= groupName %>__key"><%= keyContent %></td><td class="<%= groupName %>__value <%= cellClassName %>"><%= valueContent %></td></tr>'},
b.sv.responsiveTables.config)})(window,window.$svjq);
(function(b,l,m,q,e,p){var h=q.classNames,c=q.selectors,k=q.config;(function(){m.svRespTables||(m.svRespTables={});m.svRespTables.scroll=function(b){this.init=function(){m(b).removeClass(h.groupName).wrap(e(k.divClassTmpl,{classNames:h.groupName}))};this.init()};m.fn.svRespTables_scroll=function(){return this.each(function(){new m.svRespTables.scroll(this)})};m.svRespTables.fixedFirst=function(b){var n=this,l=h.groupName+" "+h.fixedFirst,v=q.mql,t=!1;n.$el=m(b);n.$el.data("svRespTables.fixedFirst",
n);n.init=function(){n.$el.removeClass(l).wrap(e(k.divClassTmpl,{classNames:l}))};n.splitTable=function(){n.$copy=n.$el.clone();n.$copy.css("width","100%").find("td:not(:first-child), th:not(:first-child)").hide().end().find("caption").html("&nbsp;");n.$el.closest(".sv-responsiveTable--fixedFirst").append(n.$copy);n.$copy.wrap(e(k.divStyleTmpl,{classNames:h.fixedFirst+"__pinned",styleAttr:"width: "+k.fixedFirstWidth}));n.$el.wrap(e(k.divStyleTmpl,{classNames:h.fixedFirst+"__scrollable",styleAttr:"margin-left: "+
k.fixedFirstWidth}));n.setCellHeights()};n.unSplitTable=function(){n.$el.closest(c.fixedFirst).find(c.fixedFirst+"__pinned").remove();n.$el.unwrap();n.$copy=p;n.unSetCellHeights()};n.setCellHeights=function(){var b=n.$el.find("tr"),c=n.$copy.find("tr"),e=[];b.each(function(a,b){m(b).find("th, td").each(function(){var b=m(this).outerHeight(!0);e[a]=e[a]||0;b>e[a]&&(e[a]=b)})});c.each(function(a,c){m(c).height(e[a]);b.eq(a).height(e[a])})};n.unSetCellHeights=function(){n.$el.find("tr").each(function(b,
c){c.style.height="auto"})};n.updateTables=function(){!v.matches&&t?(t=!1,n.unSplitTable()):v.matches&&!t&&(t=!0,n.splitTable())};v.addListener(n.updateTables);m(n.updateTables);n.init()};m.fn.svRespTables_fixedFirst=function(){return this.each(function(){new m.svRespTables.fixedFirst(this)})};m.svRespTables.stackTable=function(b){var c=this,l=q.mql;c.$el=m(b);c.$el.data("svRespTables.stackTable",c);c.init=function(){var b="",p,q;l.removeListener(c.init);c.$copy=m(e(k.tblTmpl,{classNames:c.$el.prop("class")+
" "+h.stackGroupName+"__smallOnly"}));c.$el.addClass(h.stackGroupName+"__largeOnly");p=c.$el.find("caption").clone();q=c.$el.find("tr").eq(0);c.$el.find("tr").each(function(c,n){var a=m(n),l="",p="",t,s=a.prop("class");0===c?b+=e(k.tblThRowTmpl,{trClassNames:s,thClassNames:h.stackGroupName+"__headRow "+h.stackGroupName+"__headRow--main",colSpan:2,content:a.find("th, td").eq(0).html()}):(a.find("td, th").each(function(a,b){var c=m(b);m.trim(c.html())&&(0===a?l+=e(k.tblThRowTmpl,{trClassNames:s,thClassNames:h.stackGroupName+
"__headRow",colSpan:2,content:c.html()}):(t=m.trim(q.find("td,th").eq(a).html()),p+=e(k.tblTrRowTmpl,{trClassNames:s,groupName:h.stackGroupName,keyContent:t?t:"",cellClassName:c.prop("class"),valueContent:c.html()})))}),b+=l+p)});c.$copy.find("tbody").before(p).html(b);c.$el.before(c.$copy)};l.matches?c.init():l.addListener(c.init)};m.fn.svRespTables_stackTable=function(){return this.each(function(){new m.svRespTables.stackTable(this)})};m.svRespTables.stackColumns=function(b){var c=this,l=q.mql;
c.$el=m(b);c.$el.data("svRespTables.stackColumns",c);c.init=function(){function b(c,a){var e=m(a),k=m("<tr></tr>"),l,n,p;0===c&&k.addClass(h.stackGroupName+"__headRow "+h.stackGroupName+"__headRow--main");l=e.find("td, th").eq(0).clone().addClass(h.stackGroupName+"__key");n=q;e.find("*[colspan]").length&&(p=0,e.find("td, th").each(function(a,b){var c=m(b).attr("colspan");if(p>q)return!1;c?(c=parseInt(c,10),n-=c-1,p+c>q&&(n+=p+c-q-1),p+=c):p++}));e=e.find("td, th").eq(n).clone();e.addClass(h.stackGroupName+
"__value").removeAttr("colspan");k.append(l,e);s.append(k)}var p=c.$el.find("tr").eq(0).find("td, th").length,q=1,s;l.removeListener(c.init);if(!(3>p)){c.$copy=m(e(k.tblTmpl,{classNames:c.$el.prop("class")+" "+h.stackGroupName+"__smallOnly"}));c.$el.addClass(h.stackGroupName+"__largeOnly");c.$el.find("caption").length&&c.$copy.find("tbody").before(c.$el.find("caption").clone());for(s=m("<tbody />");q<p;)c.$el.find("tr").each(b),++q;c.$copy.find("tbody").append(s.html());c.$el.before(c.$copy)}};l.matches?
c.init():l.addListener(c.init)};m.fn.svRespTables_stackColumns=function(){return this.each(function(){new m.svRespTables.stackColumns(this)})}})()})(window,window.document,window.$svjq,window.sv.responsiveTables,window.sv.TemplateUtil.template);
(function(b,l,m,q,e){var p,h=e.selectors;e.init=function(){var b=m(l.getElementsByTagName("table")).filter(h.groupName);0<b.length&&(e.appendCSS(),b.filter(h.scroll).svRespTables_scroll().end().filter(h.fixedFirst).svRespTables_fixedFirst().end().filter(h.stackTable).svRespTables_stackTable().end().filter(h.stackColumns).svRespTables_stackColumns())};m(function(){p=m(l.body);b.matchMedia&&p.hasClass("sv-responsive")&&!p.hasClass("sv-editing-mode")&&(e.mql=window.matchMedia("(max-width: "+e.config.breakpoint+
")"),e.init())})})(window,window.document,window.$svjq,window.sv,window.sv.responsiveTables);
(function(b,l){var m,q;function e(b){var e=document.createElement("style");b&&e.setAttribute("media","(max-width: "+b+")");e.appendChild(document.createTextNode(""));document.head.appendChild(e);return e.sheet}m=["div.sv-responsiveTable { overflow: auto; max-width: 100%; }","div.sv-responsiveTable * { white-space: nowrap !important; }","div.sv-responsiveTable--fixedFirst { position: relative; margin-bottom: 20px; overflow: hidden; border-right: 1px solid #ccc; }","div.sv-responsiveTable--fixedFirst table { margin-bottom: 0; overflow: visible; max-width: none; }",
"div.sv-responsiveTable--fixedFirst td, div.sv-responsiveTable--fixedFirst th { position: relative; overflow: hidden; }","div.sv-responsiveTable--fixedFirst__scrollable th:first-child, div.sv-responsiveTable--fixedFirst__scrollable td:first-child { display: none; }","div.sv-responsiveTable--fixedFirst__pinned { position: absolute; left: 0; top: 0; background: #fff; overflow: hidden; overflow-x: scroll; border-right: 1px solid #ccc; border-left: 1px solid #ccc; }","div.sv-responsiveTable--fixedFirst__pinned table { border-right: none; border-left: none; width: 100%; }",
"div.sv-responsiveTable--fixedFirst__pinned td:first-child, div.sv-responsiveTable--fixedFirst__pinned th:first-child { width: 100%; }","div.sv-responsiveTable--fixedFirst__scrollable { overflow: scroll; overflow-y: hidden; }",".sv-responsiveTable--stacked { overflow: visible; }",".sv-responsiveTable--stacked__largeOnly { display: none; }",".sv-responsiveTable--stacked__smallOnly { display: table; }"];q=[".sv-responsiveTable--stacked__largeOnly { display: table; }",".sv-responsiveTable--stacked__smallOnly { display: none; }"];
l.appendCSS=function(){var p=e(),h=e(l.config.breakpoint);b.each(q,function(b,e){p.insertRule(e,b)});b.each(m,function(b,e){h.insertRule(e,b)})}})(window.$svjq,window.sv.responsiveTables);
(function(){var b=window.$svjq,l=window.sv,m=window._sv,q,e=function(e){var h=e.portletId,c=e.inputField,k=e.resultDiv,s=-1,n=-1,u=function(){k.hide()};b("body").bind("click",u);var v=function(a,b){if(-1<a){var c=b.find(".sv-searchform2-search-list-column"+a);if(1===c.length)return c}},t=function(a,c){if(-1<a&&a<c.children().length)return b(c.children()[a])},y=function(a,b,c){a=v(a,c);if(void 0!==a)return t(b,a)},C=function(a){var b=0,c=v(0,a);a=v(1,a);void 0!==c&&b++;void 0!==a&&b++;return b},w=
function(a){a.children().removeClass("active")};c.keydown(function(a){a=l.KeyUtil.getKeyCodeFromEvent(a);var b=v(0,k),c=v(1,k);void 0!==b&&void 0!==c&&(a===l.KeyUtil.KEY.RIGHT&&0===n?(n=1,s=-1,w(b),a=l.KeyUtil.KEY.DOWN):a===l.KeyUtil.KEY.LEFT&&1===n&&(n=0,s=-1,w(c),a=l.KeyUtil.KEY.DOWN));if(a===l.KeyUtil.KEY.DOWN||a===l.KeyUtil.KEY.UP){var e;if(0===n&&void 0!==b)e=b;else if(1===n&&void 0!==c)e=c;else if(-1===n){var h;h=k.hasClass("sv-searchform2-result-container-alignment-left")?"left":"right";"left"===
h?void 0!==b&&(n=0,e=b):void 0!==c?(n=1,e=c):void 0!==b&&(n=0,e=b)}a===l.KeyUtil.KEY.DOWN&&void 0!==e&&s+1<e.children().length?(a=t(s+1,e),s++,w(e),a.addClass("active")):a===l.KeyUtil.KEY.UP&&void 0!==e&&-1<s&&(s--,w(e),0<=s?t(s,e).addClass("active"):n=-1);return!1}}).keyup(function(a){a=l.KeyUtil.getKeyCodeFromEvent(a);a===l.KeyUtil.KEY.ESC?u():a===l.KeyUtil.KEY.RETURN?(a=y(n,s,k),void 0!==a?location.href=a.find("a").attr("href"):1===C(k)&&(a=v(0,k).find(".sv-searchform2-more-hits"),1===a.length&&
(location.href=a.find("a").attr("href")))):l.KeyUtil.isNonTextModifiableKeyCode(a)||(void 0!==q&&clearTimeout(q),q=setTimeout(function(){var a=c.val();n=s=-1;if(""===a||2>a.length)k.css("display","none");else{var e=l.PortletUtil.getPortletResourceUri(h,"query");b.ajax({url:e,data:{term:a}}).fail(function(a){k.html('<div class="sv-searchform2-message">'+l.i18n.getText("portlet.search.searchform2.searchform2","searchFailed",a.status)+"</div>")}).done(function(e){if(a===e.term){var h=e.facets;k.empty();
k.css("width","auto");if(0===h.length)h=m.template('<div class="sv-searchform2-message">   <<%= noHitsTag %> class="<%= noHitsClass %>"><%= noHitsText %></<%= noHitsTag %>></div>'),k.append(b(h(e)));else{var p=document.documentElement.clientWidth,q=e.width/2,v=q*h.length;v>p&&(300<p?(q=p/2,v=q*h.length):v=q>p?q=p:q);for(p=0;p<h.length;p++){var t=h[p],u;"content"===t.type?u='<div class="sv-border-box sv-searchform2-facet-column'+p+'" style="width: '+q+'px">   <<%= facetTag %> class="<%= facetTagClass %>"><%= name %></<%= facetTag %>>   <ul class="sv-defaultlist sv-user-search-list sv-searchform2-search-list sv-searchform2-search-list-column'+
p+'">      <% _.each(hits, function(hit){ %>         <li class="sv-searchform2-search-hit"><a class="sv-vamiddle <%= contentTagClass %>" href="<%= hit.URL %>" onclick="<%= hit.onClick %>"><%= hit.name %></a><% if (typeof(hit.iconURL) !== \'undefined\') { %><img alt="<%= hit.iconDescription %>" class="sv-noborder-vamiddle" src="<%= hit.iconURL %>" style="margin-left: 3px;"><% } %></li>      <% }); %>      <% if (showDetails) { %>         <li class="sv-clearfix sv-searchform2-search-hit sv-searchform2-more-hits"><<%= textTag %> class="<%= textTagClass %>"><a href="<%= showDetailsURL %>"><%= showDetailsText %></a></<%= textTag %>></li>      <% } %>   </ul></div>':
"users"===t.type?u='<div class="sv-border-box sv-searchform2-facet-column'+p+'" style="width: '+q+'px">   <<%= facetTag %> class="<%= facetTagClass %>"><%= name %></<%= facetTag %>>   <ul class="sv-defaultlist sv-user-search-list sv-searchform2-search-list sv-searchform2-search-list-column'+p+'">      <% _.each(hits, function(hit){ %>         <li class="sv-clearfix sv-searchform2-search-hit">            <img class="sv-buddy-icon sv-searchform2-user-img" src="<%= hit.iconURL %>" />            <% if (hit.isContact) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>            <div class="sv-searchform2-user-container">               <<%= userBlockTag %> class="sv-searchform2-user-name <%= userTagClass %>"><a href="<%= hit.profileURL %>" onclick="<%= hit.onClick %>"><%= hit.name %></a></<%= userBlockTag %>>               <% if (typeof(hit.userfields) !== \'undefined\') { %>                  <ul class="sv-searchform2-userfield-list">                     <% _.each(hit.userfields, function(userfield){ %>                        <li class="<%= textTagClass %> sv-wrap-words"><%= userfield.value %></li>                     <% }); %>                  </ul>               <% } %>            </div>         </li>      <% }); %>      <% if (showDetails) { %>         <li class="sv-clearfix sv-searchform2-search-hit sv-searchform2-more-hits"><<%= textTag %> class="<%= textTagClass %>"><a href="<%= showDetailsURL %>"><%= showDetailsText %></a></<%= textTag %>></li>      <% } %>   </ul></div>':
(u="",l.Log.error("Skipping unsupported facet type "+t.type));u=m.template(u);k.css("width",v);k.append(b(u(t)))}var y=k.find("ul.sv-user-search-list");y.find("li.sv-searchform2-search-hit").mouseenter(function(){var a=b(this);var c=a.parent();n=c.hasClass("sv-searchform2-search-list-column0")?0:c.hasClass("sv-searchform2-search-list-column1")?1:-1;s=a.index();w(y);a.addClass("active")}).mouseleave(function(){s=n=-1;b(this).removeClass("active")}).click(function(a){b(a.target).is("a")||(a=b(this),
location.href=a.find("a").attr("href"))})}h=e.facetAlignment+" top";e=e.facetAlignment+" bottom";k.show();k.position({my:h,at:e,of:c,offset:"0 1",collision:"none"})}})}},200));return!1})};b(".sv-searchform2-portlet").each(function(){var m=b(this),h=l.ObjectUtil.getObjectId(m.attr("id")),c=m.find(".sv-searchform2-result-container"),m=m.find(".sv-searchform2-input");m.attr("autocomplete","off");e({portletId:h,inputField:m,resultDiv:c})})})();
(function(){var b=window.$svjq,l=window.sv,m=l.ObjectUtil,q=l.PortletUtil,e=window.SVBackbone,l=e.Model.extend({getViewUrl:function(){return this.get("url")},isFolder:function(){return this.get("isFolder")}}),p=e.Collection.extend({model:l,initialize:function(b,c){this.portletId=c.portletId;this.currentFolderProps=c.currentFolderProps},url:function(){return q.getPortletResourceUri(this.portletId,"files")},setCurrentFolderProps:function(b){this.currentFolderProps=b},getCurrentFolderProps:function(){return this.currentFolderProps},
parse:function(b){this.setCurrentFolderProps(b.currentFolderProps);return b.items}}),h=e.View.extend({tagName:"tr",events:{"click [data-fetch-item]":"fetchItem"},initialize:function(){this.template=this.options.template;this.model.set("fontClass",this.model.isFolder()?this.options.folderFontClass:this.options.fileFontClass);this.portletView=this.options.portletView},render:function(){this.$el.html(this.template(this.model.toJSON(),this.model));return this},fetchItem:function(b){this.model.isFolder()&&
(b.preventDefault(),this.portletView.fetchFolder(this.model))}}),c=e.View.extend({initialize:function(){this.itemTemplate=this.options.itemTemplate;this.fileFontClass=this.options.fileFontClass;this.folderFontClass=this.options.folderFontClass;this.portletView=null},render:function(){this.clearTable();this.collection.each(function(b){this.appendOne(b)},this)},appendOne:function(b){b=new h({model:b,template:this.itemTemplate,portletView:this.portletView,fileFontClass:this.fileFontClass,folderFontClass:this.folderFontClass});
this.$el.append(b.render().el)},clearTable:function(){this.$el.empty()}}),k=l.extend({isFolder:function(){return!0}}),s=e.View.extend({tagName:"li",events:{"click [data-fetch-folder]":"fetchFolder"},initialize:function(){this.template=this.options.template;this.portletView=this.options.portletView;this.model.set("isActive",this.options.isActive)},render:function(){this.$el.html(this.template(this.model.toJSON(),this.model));return this},fetchFolder:function(b){b.preventDefault();this.portletView.fetchFolder(this.model)}}),
n=e.View.extend({initialize:function(){this.breadcrumbTemplate=this.options.breadcrumbTemplate;this.portletView=null},render:function(){this.clearList();this.collection.each(function(b,c){this.appendOne(b,c===this.collection.length-1)},this)},appendOne:function(b,c){var e=new s({model:b,template:this.breadcrumbTemplate,portletView:this.portletView,isActive:c});this.$el.append(e.render().el)},clearList:function(){this.$el.empty()}}),u=e.View.extend({initialize:function(){this.breadcrumbCollectionView=
this.options.breadcrumbCollectionView;this.breadcrumbCollection=this.breadcrumbCollectionView.collection;this.itemCollectionView=this.options.itemCollectionView;this.itemCollection=this.itemCollectionView.collection;this.breadcrumbCollectionView.portletView=this;this.itemCollectionView.portletView=this},render:function(){this.breadcrumbCollectionView.render();this.itemCollectionView.render()},fetchFolder:function(b){var c=this.itemCollection.getCurrentFolderProps();this.itemCollection.fetch({data:{sharePointFolderId:b.id,
trail:c.trail,trailTime:c.trailTime},context:this}).done(function(c){c.unauthorized?window.location.href=b.getViewUrl():(this.breadcrumbCollection.reset(c.breadcrumbs),this.render())})}});b(".sv-sharepointfile-portlet").each(function(){var h=b(this),l=m.getObjectId(h.attr("id")),s=h.find(".sv-sharepointfile-root"),C=s.data("js-namespace"),w=window.sv[C]||[];if(0!==w.length){var a=s.find(".sv-sharepointfile-breadcrumbs"),s=s.find(".sv-sharepointfile-files tbody"),C=s.data("file-font-class"),z=s.data("folder-font-class"),
B=w.items,x=w.currentFolderProps,F=w.breadcrumbs,w=q.getTemplate(h,"sharepointitem"),h=q.getTemplate(h,"sharepointbreadcrumb"),F=new e.Collection(F,{model:k}),a=new n({el:a,collection:F,breadcrumbTemplate:h}),l=new p(B,{portletId:l,currentFolderProps:x}),l=new c({el:s,collection:l,breadcrumbCollectionView:a,fileFontClass:C,folderFontClass:z,itemTemplate:w});(new u({breadcrumbCollectionView:a,itemCollectionView:l})).render()}})})();
(function(){var b=window.$svjq,l=window.sv;b(".sv-sharepointfile-portlet, .sv-sharepointsearchfilelist-portlet").each(function(){var m=b(this),q=m.find(".sv-sharepoint-login-modal");q.svDialog({title:l.i18n.getText("portlet.sharepoint.sharepointfile","connectToSharePoint"),open:!1,modal:!0,buttons:[{text:l.i18n.getText("portlet.sharepoint.sharepointfile","loginButton"),type:"primary",callback:function(b){b.preventDefault();q.find("form").submit()}},{text:l.i18n.getText("common","cancel"),type:"link",
callback:function(){q.svDialog("close")}}]});m.find(".sv-sharepoint-modal-button").click(function(){q.svDialog("open")})})})();
(function(){function b(){k&&0!==k.length||(k=p("<div/>"));return k}function l(c){c.preventDefault();c=b().find("form");p.post(c.attr("action"),c.serialize(),function(c){m();-1!==c.indexOf('http-equiv="Refresh"')?window.location.href=p("input[name=redirectURL]").attr("value"):0<p(c).find("div#error-messages").length?k=p("<div/>").html(c).svDialog({open:!0,title:p("input[name=windowTitle]").attr("value"),buttons:[{text:p("input[name=buttonText]").attr("value"),type:"primary",callback:l},{text:p("input[name=closeButtonText]").attr("value"),
type:"link",callback:m}]}):(k=b(),s?s.html(c).svDialog("open"):s=p("<div/>").html(c).svDialog({open:!0,title:p("input[name=windowTitle]").attr("value"),buttons:[{text:p("input[name=closeButtonText]").attr("value"),type:"primary",callback:q}]}))})}function m(){k.svDialog("remove")}function q(){s.svDialog("close")}function e(c){c=p("#"+c);k=b();c.on("click",function(b){b.preventDefault();k.svDialog({open:!0,url:this.href,title:p("input[name=windowTitle]").attr("value"),modal:!0,buttons:[{text:p("input[name=buttonText]").attr("value"),
type:"primary",callback:l},{text:p("input[name=closeButtonText]").attr("value"),type:"link",callback:m}]})})}var p=window.$svjq,h=window.sv,c,k,s;if(h.tellfriend2&&h.tellfriend2.length)for(c=0;c<h.tellfriend2.length;c+=1)e(h.tellfriend2[c])})();
